以下は「配合×マッチング」要素のUI/UXだけを、Flutterアプリで動かして確認するための設計書です。バックエンドやゲームバランスは作り込みません。目的は、ユーザーが迷わず操作できるか、気持ちよく回せるか、結果が納得できる表示になっているかを、画面遷移とインタラクション中心に検証することです。

**設計方針の再構築**: 本設計書は、世界目的→ローグライク周回→配合/マッチング（相談所＋ダンジョン遭遇）→継承メタ進行、の順に"面白さの役割分担"を再設計しています。配合とマッチングは「ゲーム全体が回り続ける目的と構造」の中に"意味のある手段"として配置され、配合は"強化手段"ではなく、**ローグライク周回の生存戦略と、世代継承の経営判断**として位置づけられています。

# 目次

1. [ドキュメント概要](#1-ドキュメント概要)
   - 1.1 [目的](#11-目的)
   - 1.2 [スコープ](#12-スコープ)
   - 1.3 [想定プラットフォーム](#13-想定プラットフォーム)
2. [UX方針と設計原則](#2-ux方針と設計原則)
   - 2.1 [世界の目的と評価指標](#21-世界の目的と評価指標)
   - 2.2 [面白さの3層構造](#22-面白さの3層構造)
   - 2.3 [全体ループ：相談所経営×ダンジョン周回×世代継承](#23-全体ループ相談所経営ダンジョン周回世代継承)
   - 2.4 [マッチングの分業：相談所とダンジョン](#24-マッチングの分業相談所とダンジョン)
   - 2.5 [永続資産の3カテゴリ](#25-永続資産の3カテゴリ)
   - 2.6 [「一期一会の演出」と「再現性のある法則」の分離](#26-一期一会の演出と再現性のある法則の分離)
   - 2.7 [予測可能性の担保](#27-予測可能性の担保)
   - 2.8 [反復行動を疲れさせない](#28-反復行動を疲れさせない)
3. [主要ユーザーと利用シナリオ](#3-主要ユーザーと利用シナリオ)
   - 3.1 [想定ユーザー](#31-想定ユーザー)
   - 3.2 [主要シナリオ](#32-主要シナリオ)
4. [情報設計とナビゲーション](#4-情報設計とナビゲーション)
   - 4.1 [画面構成](#41-画面構成)
   - 4.2 [グローバルナビゲーション](#42-グローバルナビゲーション)
5. [画面設計](#5-画面設計)
   - 5.0 [相談所（拠点フェーズ）](#50-相談所拠点フェーズ)
     - 5.0.1 [マッチング準備（相談所の案件）](#501-マッチング準備相談所の案件)
     - 5.0.2 [相談所の成長とメタ進行](#502-相談所の成長とメタ進行)
   - 5.1 [ホーム（ダッシュボード）](#51-ホームダッシュボード)
     - 5.1.1 [情報設計の4層構造](#511-情報設計の4層構造)
     - 5.1.2 [UIデザインの方針](#512-uiデザインの方針)
     - 5.1.3 [ローディングと初回体験](#513-ローディングと初回体験)
   - 5.2 [探す（ディスカバー／スワイプ）](#52-探すディスカバー／スワイプ)
     - 5.2.0 [パラメータの段階的表示（4層構造）](#520-パラメータの段階的表示4層構造)
     - 5.2.1 [目標への貢献度と道中ボス連携](#521-目標への貢献度と道中ボス連携)
     - 5.2.2 [格上からの承認演出](#522-格上からの承認演出)
     - 5.2.3 [状態管理](#523-状態管理)
   - 5.3 [候補詳細（プロフィールモーダル）](#53-候補詳細プロフィールモーダル)
   - 5.4 [マッチ一覧](#54-マッチ一覧)
   - 5.5 [マッチ後セッション（ミニゲームによる好感度とパラメータ開示）](#55-マッチ後セッションミニゲームによる好感度とパラメータ開示)
     - 5.5.0 [好感度システムとパラメータ開示の基本設計](#550-好感度システムとパラメータ開示の基本設計)
     - 5.5.1 [ミニゲームの種類と実装方法](#551-ミニゲームの種類と実装方法)
       - 5.5.1.1 [契約交渉（会話カード）型](#5511-契約交渉会話カード型)
       - 5.5.1.2 [共鳴調律（パズル）型](#5512-共鳴調律パズル型)
       - 5.5.1.3 [儀式手順（記憶・順序）型](#5513-儀式手順記憶・順序型)
       - 5.5.1.4 [贈与/供物の調合（選択）型](#5514-贈与供物の調合選択型)
       - 5.5.1.5 [同行試練（短い判断）型](#5515-同行試練短い判断型)
     - 5.5.2 [セッションの流れ](#552-セッションの流れ)
     - 5.5.3 [盟約（コミット）の選択](#553-盟約コミットの選択)
     - 5.5.4 [セッション完了とフィードバック](#554-セッション完了とフィードバック)
     - 5.5.5 [フィルタとの連携](#555-フィルタとの連携)
   - 5.6 [配合プランナー](#56-配合プランナー)
     - 5.6.1 [未達条件と条件達成によるプレビュー変化](#561-未達条件と条件達成によるプレビュー変化)
     - 5.6.2 [差分表示（比較機能）](#562-差分表示比較機能)
     - 5.6.3 [道中ボスとの連携（要求ビルドの提示）](#563-道中ボスとの連携要求ビルドの提示)
     - 5.6.4 [配合実行と確認](#564-配合実行と確認)
   - 5.7 [配合結果](#57-配合結果)
   - 5.8 [所持一覧（コレクション）](#58-所持一覧コレクション)
   - 5.9 [深層ダンジョン探索](#59-深層ダンジョン探索)
     - 5.9.1 [探索の基本構造：分岐ノード＋部屋単位](#591-探索の基本構造分岐ノード部屋単位)
     - 5.9.2 [探索画面のHUD設計](#592-探索画面のhud設計)
     - 5.9.3 [ノード（部屋）の情報設計](#593-ノード部屋の情報設計)
     - 5.9.4 [マッチング要素の統合](#594-マッチング要素の統合)
     - 5.9.5 [深層らしさの演出](#595-深層らしさの演出)
   - 5.10 [設定](#510-設定)
6. [UIコンポーネント定義](#6-uiコンポーネント定義)
7. [画面間遷移と主要フロー](#7-画面間遷移と主要フロー)
   - 7.1 [全体ループ：相談所経営×ダンジョン周回×世代継承](#71-全体ループ相談所経営ダンジョン周回世代継承)
     - 7.1.1 [相談所フェーズ（拠点）](#711-相談所フェーズ拠点)
     - 7.1.2 [探索フェーズ（ラン）](#712-探索フェーズラン)
     - 7.1.3 [継承フェーズ（世代更新）](#713-継承フェーズ世代更新)
   - 7.2 [主要フロー（感情的な楽しさ）](#72-主要フロー感情的な楽しさ)
   - 7.3 [別フロー（計画性の快適さ）](#73-別フロー計画性の快適さ)
   - 7.4 [転生ループのフロー](#74-転生ループのフロー)
8. [データ設計（UI用のモック）](#8-データ設計ui用のモック)
   - 8.0 [自キャラクターのデータ構造](#80-自キャラクターのデータ構造)
   - 8.1 [永続資産のデータ構造（3カテゴリ）](#81-永続資産のデータ構造3カテゴリ)
     - 8.1.1 [知識（法則・テーブルの解像度）](#811-知識法則テーブルの解像度)
     - 8.1.2 [制度（相談所・契約枠・推薦枠）](#812-制度相談所契約枠推薦枠)
     - 8.1.3 [系譜コア（次世代の初期条件）](#813-系譜コア次世代の初期条件)
   - 8.2 [パラメータの4層構造のデータ構造](#82-パラメータの4層構造のデータ構造)
     - 8.2.1 [第一層：公開情報](#821-第一層公開情報)
     - 8.2.2 [第二層：準公開情報（推定表示）](#822-第二層準公開情報推定表示)
     - 8.2.3 [第三層：深掘り情報](#823-第三層深掘り情報)
     - 8.2.4 [第四層：サプライズ情報](#824-第四層サプライズ情報)
   - 8.3 [マッチ後セッション（ミニゲーム）のデータ構造](#83-マッチ後セッションミニゲームのデータ構造)
     - 8.3.1 [契約交渉（会話カード）型](#831-契約交渉会話カード型)
     - 8.3.2 [共鳴調律（パズル）型](#832-共鳴調律パズル型)
     - 8.3.3 [儀式手順（記憶・順序）型](#833-儀式手順記憶・順序型)
     - 8.3.4 [贈与/供物の調合（選択）型](#834-贈与供物の調合選択型)
     - 8.3.5 [同行試練（短い判断）型](#835-同行試練短い判断型)
   - 8.4 [道中ボスのデータ構造](#84-道中ボスのデータ構造)
9. [エラーと例外の設計](#9-エラーと例外の設計)
10. [アクセシビリティと操作性](#10-アクセシビリティと操作性)
11. [検証項目（UXテスト観点）](#11-検証項目uxテスト観点)
    - 11.1 [基本UX検証項目](#111-基本ux検証項目)
    - 11.2 [ゲーム性の検証項目](#112-ゲーム性の検証項目)
12. [受け入れ基準（プロトタイプ完成条件）](#12-受け入れ基準プロトタイプ完成条件)
    - 12.1 [基本機能の完成条件](#121-基本機能の完成条件)
    - 12.2 [ゲーム性の完成条件](#122-ゲーム性の完成条件)
13. [実装状況と設計書との差異](#13-実装状況と設計書との差異)
    - 13.1 [実装済みの主要機能](#131-実装済みの主要機能)
      - 13.1.1 [技術スタック](#1311-技術スタック)
      - 13.1.2 [基本画面構成](#1312-基本画面構成)
      - 13.1.3 [ナビゲーション](#1313-ナビゲーション)
      - 13.1.4 [基本機能](#1314-基本機能)
    - 13.2 [未実装の機能（設計書との差異）](#132-未実装の機能設計書との差異)
    - 13.3 [実装方針の差異](#133-実装方針の差異)
    - 13.4 [優先度の高い未実装機能（UX検証に重要）](#134-優先度の高い未実装機能ux検証に重要)
    - 13.5 [実装の品質に関する所見](#135-実装の品質に関する所見)
    - 13.6 [次のステップへの推奨事項](#136-次のステップへの推奨事項)
14. [ゲーム性の詳細設計](#14-ゲーム性の詳細設計)
    - 14.1 [ゲーム性の核：ローグライク周回と世代継承の中心](#141-ゲーム性の核ローグライク周回と世代継承の中心)
    - 14.2 [永続資産の詳細（3カテゴリ）](#142-永続資産の詳細3カテゴリ)
      - 14.2.1 [知識（法則・テーブルの解像度）](#1421-知識法則テーブルの解像度)
      - 14.2.2 [制度（相談所・契約枠・推薦枠）](#1422-制度相談所契約枠推薦枠)
      - 14.2.3 [系譜コア（次世代の初期条件）](#1423-系譜コア次世代の初期条件)
      - 14.2.4 [永続資産のバランス設計](#1424-永続資産のバランス設計)
    - 14.3 [格付け市場と承認演出](#143-格付け市場と承認演出)
      - 14.3.1 [格付けの仕組み](#1431-格付けの仕組み)
      - 14.3.2 [格上からの承認](#1432-格上からの承認)
    - 14.4 [マッチ後セッションの詳細（ミニゲームによる好感度とパラメータ開示）](#144-マッチ後セッションの詳細ミニゲームによる好感度とパラメータ開示)
      - 14.4.1 [セッションの流れと好感度システム](#1441-セッションの流れと好感度システム)
      - 14.4.2 [ミニゲームの種類と実装方法](#1442-ミニゲームの種類と実装方法)
      - 14.4.3 [パラメータ開示のタイミング](#1443-パラメータ開示のタイミング)
      - 14.4.4 [盟約（コミット）の選択](#1444-盟約コミットの選択)
      - 14.4.5 [セッション完了とフィードバック](#1445-セッション完了とフィードバック)
      - 14.4.6 [フィルタとの連携](#1446-フィルタとの連携)
    - 14.5 [深層ダンジョン探索のUX設計](#145-深層ダンジョン探索のux設計)
      - 14.5.1 [探索の基本構造：分岐ノード＋部屋単位](#1451-探索の基本構造分岐ノード部屋単位)
      - 14.5.2 [探索画面のHUD設計](#1452-探索画面のhud設計)
      - 14.5.3 [ノード（部屋）の情報設計](#1453-ノード部屋の情報設計)
      - 14.5.4 [マッチング要素の統合](#1454-マッチング要素の統合)
      - 14.5.5 [深層らしさの演出](#1455-深層らしさの演出)
      - 14.5.6 [Webプロトタイプでの最小セット](#1456-webプロトタイプでの最小セット)
    - 14.6 [道中ボスと要求ビルド](#146-道中ボスと要求ビルド)
      - 14.6.1 [ボスごとの要求ビルド](#1461-ボスごとの要求ビルド)
      - 14.6.2 [ボスの脅威プロファイル](#1462-ボスの脅威プロファイル)
      - 14.6.3 [行動ループ](#1463-行動ループ)
    - 14.7 [失敗の学習化](#147-失敗の学習化)
      - 14.7.1 [失敗周回でも価値がある設計](#1471-失敗周回でも価値がある設計)
      - 14.7.2 [学習の可視化](#1472-学習の可視化)
    - 14.8 [面白さの中心](#148-面白さの中心)

# 1. ドキュメント概要

## 1.1 目的

本Flutterアプリは、配合システムに「マッチングアプリ的な体験」を組み込んだときの、候補提示、スワイプ、マッチ成立、関係値（ボンド）強化、配合プランニング、配合結果提示までの一連のUI/UXを検証するためのプロトタイプです。検証対象は、操作の直感性、情報提示の分かりやすさ、結果の予測可能性、反復行動のストレス、そして「一期一会っぽい演出」と「法則性のある結果」の両立感です。

## 1.2 スコープ

スコープに含めるのは、画面、ナビゲーション、操作感、アニメーション、コピー文言、状態（ローディング、エラー、枯渇、権限制御）です。スコープに含めないのは、実際のゲーム本編、戦闘、収益化、真のレアリティ設計、サーバー連携、厳密な配合テーブルの完全実装です。配合結果は、固定ルールの簡易版か、疑似テーブルで十分です。

## 1.3 想定プラットフォーム

Flutterアプリとして、Webブラウザ、iOS、Androidの3プラットフォームに対応します。UIはレスポンシブにし、スマホではスワイプが主、PCではドラッグとキー操作（左右矢印、Enter）で同等体験を提供します。

# 2. UX方針と設計原則

## 2.1 世界の目的と評価指標

現実のマッチングアプリの評価指標（学歴・年収・外見・コミュ力など）をそのまま持ち込むと薄っぺらくなるため、この世界で価値があるものを明確にします。配合やマッチとは独立した"世界側の評価指標"として、ゲーム世界の物理・社会の要請から逆算して価値観を作ります。

### 2.1.1 世界の価値観を作るための評価指標（3階層構造）

現実の評価軸をゲームに翻訳するなら、次の3階層に分けると設計しやすいです。

#### 第一層：世界の存続に効く評価（公共指標）

世界の目的そのものなので、物語と直結しやすい指標です。ただし、数値的な指標（封印の安定度、瘴気後退率など）として管理するのではなく、**ダンジョンの踏破状況**で判断できるようにします。

世界の状況は、以下の要素から自然に読み取れるものとします：
- **最深部への到達度**：ダンジョンの踏破状況（到達階層、封印の楔を打ち直した数）で表現
- **瘴気の封印状況**：最深部への到達と封印の楔を打ち直すことで、瘴気の後退が自然に表現される
- **世界の状態**：ストーリーや世界観の文脈で表現される（例：「封印が揺らいでいる」「最深部の瘴気が濃い」など）

数値として管理するのではなく、ダンジョンの進行状況（到達階層、達成した目標、封印の状態など）から、世界の状況を自然に読み取れるようにします。これにより、「ダンジョンの奥に行けたか」「世界が救われているか」が、数値ではなく物語や世界観の中で表現されます。

#### 第二層：組織内での信用（社会指標）

相談所・ギルド・研究機関がある世界なら、組織内での評判や信用が指標になります：
- **評判**：相談所での実績、依頼達成率
- **依頼達成率**：相談所からの依頼をどれだけ達成したか
- **事故率**：配合や契約での事故の少なさ
- **契約違反率**：契約を破棄・違反した回数の少なさ
- **後継個体の品質保証**：配合で生み出した個体の品質評価

ここに「相談所ビジネス」が自然に乗り、マッチングと配合が社会システムの一部として機能します。

#### 第三層：血統の資産（系譜指標）

配合の再現性問題を救うのはここで、個体のユニークさは演出に寄せつつ、計画性は"系譜（型）"に寄せます：
- **系譜ランク**：特定の系譜の完成度・評価
- **継承枠の期待値**：次世代に継承できる枠の平均値
- **安定度（事故率の低さ）**：配合時の事故率の低さ
- **特性スロットの解放数**：解放された特性スロットの数
- **系譜図鑑の埋まり具合**：発見・配合した系譜の種類数

この3つを並立させると、「火氷両耐性が必要」みたいなゲート条件が、単なる強さ逆行の足枷になりにくくなります。公共指標は"ダンジョンの奥に行けたか"（数値ではなく踏破状況で表現）、社会指標は"安全に帰って来たか"、系譜指標は"次が楽になる資産が増えたか"に置けるので、強さと別軸で納得しやすくなります。

### 2.1.2 ゲームの目的候補と評価

「RPG型」「ローグで周回」「次世代に継承」を前提に、世界ゴールの型を6つ出し、評価軸で相対評価します。評価軸は、(1)ローグ周回との噛み合い、(2)配合の計画性を壊さないか、(3)プレイヤーが理解しやすいか（参照コスト）、(4)反復が作業になりにくいか（変化を入れやすいか）、(5)実装難度（RPGとして）で見ます。

#### A. 封印維持・ダンジョン踏破型（世界を救うために"奥で何かする"）

**総評：最も強い**。ローグの「短い体験」「無駄時間最小化」を守りやすく、1ランのゴールが明確です。『Into the Breach』が重視した"読みやすさと短い体験"に寄せやすい。配合は「奥へ行くための資産づくり」に素直に接続できます。

**評価**：
- ローグ周回との噛み合い：★★★★★
- 配合の計画性を壊さないか：★★★★★
- プレイヤーが理解しやすいか：★★★★★
- 反復が作業になりにくいか：★★★☆☆（単調になりやすいので"奥の意味"を変奏で増やす必要）
- 実装難度：★★★☆☆

**弱点**：単調になりやすいので"奥の意味"を変奏（救助、回収、浄化、観測など）で増やす必要があります。

#### B. 汚染浄化・復旧型（世界パラメータを押し戻す）

**総評：Aと並んで強い**。公共指標が分かりやすく、周回の成果が見えます。ただし"数字が増えるだけ"にすると作業になりやすいので、浄化により「新ルート解禁」「相談所の品揃え変化」「遭遇テーブル変化」など、選択肢が増える方向の恒久変化に寄せるべきです。これは『Dead Cells』の「恒久変化でルートが増える」方向性が参考になります。

**評価**：
- ローグ周回との噛み合い：★★★★★
- 配合の計画性を壊さないか：★★★★☆
- プレイヤーが理解しやすいか：★★★★★
- 反復が作業になりにくいか：★★★☆☆（恒久変化の設計が要る）
- 実装難度：★★★☆☆

#### C. 地図復元・航路開拓型（探索で世界が広がる）

**総評：ローグと相性が良い**。周回の成果が"地図"として残るので、死んでも前進感が作りやすい。個体がユニークでも「次はあそこを埋める」という目的が立つ。ただし、地図埋めが最適化されるとルーティン化しやすいので、毎回の地形変化と"情報の残り方"の設計が要ります（完全固定にするとローグでなくなる、完全リセットにすると積み上がらない）。

**評価**：
- ローグ周回との噛み合い：★★★★☆
- 配合の計画性を壊さないか：★★★★☆
- プレイヤーが理解しやすいか：★★★★☆
- 反復が作業になりにくいか：★★★☆☆（ルーティン化のリスク）
- 実装難度：★★★★☆

#### D. 研究・系譜図鑑完成型（血統と世界の謎を解く）

**総評：あなたの「配合相談所」と最も自然に接続できる**。世界の価値観が"系譜資産"に寄るので、マッチングやボンドの意味付けが簡単です。『Hades』が語る「死んでも残るのは知識」というローグの本質とも噛み合います。ただし"研究のための周回"は、人によっては作業になりやすいので、研究成果が「戦いを楽にする」ではなく「選択が面白くなる（新しい儀式、交渉、遭遇の分岐）」に効くよう設計した方が中毒性が保てます。

**評価**：
- ローグ周回との噛み合い：★★★★☆
- 配合の計画性を壊さないか：★★★★★
- プレイヤーが理解しやすいか：★★★★★
- 反復が作業になりにくいか：★★★☆☆（研究成果の効果設計が要る）
- 実装難度：★★★☆☆

#### E. ギルド経営・都市発展型（相談所ビジネスを前面に）

**総評：魅力はあるが、危険も大きい**。ローグのコアに"別ゲーム（経営）"を入れると、参照コストと説明コストが跳ね上がります。混ぜ物が増えるほど「何が重要か分からない」状態になりやすいのは、要素混合のコストとして警告されています。もしやるなら、経営は「UI演出と軽い選択（2択）」に抑え、実質は"相談所の品揃えと契約条件を変える装置"に留めるのが安全です。

**評価**：
- ローグ周回との噛み合い：★★☆☆☆
- 配合の計画性を壊さないか：★★★☆☆
- プレイヤーが理解しやすいか：★★☆☆☆（参照コストが高い）
- 反復が作業になりにくいか：★★★☆☆
- 実装難度：★★★★☆

#### F. 競技・リーグ制覇型（シーズン制の塔・大会）

**総評：短い体験と相性が良い**。周回の区切りが作りやすい一方で、世界救済の物語を乗せにくい。物語よりシステム中毒に寄せるなら強いですが、あなたが求めている「主人公や世界の目的」には別の意味付け（勝つと封印が進む等）が必要になります。

**評価**：
- ローグ周回との噛み合い：★★★★☆
- 配合の計画性を壊さないか：★★★☆☆
- プレイヤーが理解しやすいか：★★★★☆
- 反復が作業になりにくいか：★★★☆☆
- 実装難度：★★★☆☆

**採点の結論**：推奨は **A（踏破）かB（浄化）を"公共指標"に置き、D（研究・系譜）を"個人指標"として重ねる** 形です。A/Bがゲームの外的ゴール、Dが内的ゴールになり、周回の動機が二重化します。

### 2.1.3 推奨アーキテクチャ：「遠征ローグ × 封印（公共） × 系譜研究（個人） × 相談所（社会）」

主人公（あなた）は「系譜遠征士」あるいは「契約師」で、世界の深層ダンジョンは瘴気で地形も因果も揺らいでいる。世界を救うには深層の"楔（くさび）"を打ち直す必要があるが、人間は奥まで耐えられない。そこで"代替わりする使役獣"を世代交代させながら、少しずつ楔を進めるのが人類の生存戦略で、相談所ビジネスが成立している、という建て付けです。

**重要な線引き**：「子の種族（型）は決定論で、個体プロフィールは一期一会」という方針を、世界観側の"制度"にしてしまうことです。つまり相談所は、個体そのものを売るのではなく「系譜の型」「継承枠の期待値」「事故率保証」「契約条件」を商品として提示する。これなら、同じ個体がいなくても、プレイヤーは"型"で計画でき、個体のユニークさは演出として楽しめます。

### 2.1.4 ローグライクのリセット前に何が継承されるべきか

名作の批評に合わせるなら、継承は「能力値の積み上げ」より「選択肢の増加」と「納得できる決定論」に寄せるのが安全です。『Dead Cells』の恒久変化がルートや選択肢を増やす方向で機能しているのは、その好例です。具体的には、次の3点を"継承の三層"にするとバランスが取りやすいです。

#### 第一層：知識（情報の継承）

強さではなく"計画性"を上げる資産。『Hades』が言う"ローグでも結局持ち帰るのは知識"を正面からゲーム化します：
- **敵図鑑**：遭遇した敵の情報、弱点、行動パターン
- **遭遇の分岐条件**：特定のイベントが発生する条件
- **相談所の噂**：候補の出やすさ、希少遭遇のヒント
- **配合の確定条件**：特定の配合結果を確定させる条件、事故回避の方法

#### 第二層：選択肢（手段の継承）

相談所の契約条項の追加、ボンド行動（共同訓練・儀式・交渉）の解禁、ダンジョン内での遭遇プロトコル（奇襲せず交渉できる等）の解禁です。これが増えるほど、周回が"同じことの繰り返し"になりにくい：
- **相談所の契約条項の追加**：次周回で選択できる契約条項が増える
- **ボンド行動の解禁**：新しいミニゲームや交渉手段が使えるようになる
- **遭遇プロトコルの解禁**：ダンジョン内での新しい遭遇方法が使えるようになる

#### 第三層：系譜資産（配合の継承）

子の型は決定論、ただし継承枠・特性スロット・事故率・候補スキル幅がボンドや契約で揺れる、という分離方針です。これは『Into the Breach』のように"結果の納得感"を保ちやすい設計です：
- **継承枠の期待値**：次世代に継承できる枠の平均値が上がる
- **特性スロットの解放**：新しい特性スロットが使えるようになる
- **事故率の改善**：配合時の事故率が下がる、または事故の内容が軽くなる
- **候補スキル幅の拡大**：継承できるスキルの種類が増える

### 2.1.5 マッチ後の試行錯誤（会話→デート→交際）の"中毒メカニズム"をゲームに落とす方法

現実の「会話して、デートして、交際」は、ゲームではそのままやる必要がなく、機能だけ抜き出せばいいです。中毒性の機能はだいたい次の3つです。

#### 一つ目：相手の不確実性が、行動で減っていく快感

会話で情報が増え、相性の当たりが付く。これをゲームにすると、ボンドセッションは"関係値ゲージ"だけでなく、「その系譜の隠れタグが判明」「継承事故の原因が見える化」「確定条件が開示」みたいに、情報が増える報酬に寄せるのが効きます。

#### 二つ目：コミットが重くなるほど、撤退が惜しくなる（投資のエスカレーション）

これは危険な麻薬ですが、ゲームでは"後悔の納得感"に使えます。例えば、ボンド行動を重ねるほど「この2体を配合したときの継承品質が上がる」が、同時に「ダンジョンでの別の良い遭遇を逃す」など、時間資源でトレードオフを作る。『Into the Breach』の制約にある「無駄時間最小化」「短い体験」を壊さない範囲で、選択を重くします。

#### 三つ目：反復しても文脈が変わる（同じセリフでも意味が変わる）

これは『Hades』が強いところで、死や成功のたびに会話や関係が進み、反復が物語に吸収されます。ただし批評として"敵やボスが同じで疲れる"問題があるので、ボンドセッションも同じことを繰り返すと飽きます。だから会話型にするなら、テキスト量で殴るより「選択肢の機能が変わる（情報開示、契約条項、事故率制御）」方向で変奏した方が開発コストも低いです。

### 2.1.6 再検討した推奨（何を削り、どこに面白さを置くべきか）

ローグ名作の批評を踏まえると、推奨は次の形に収束します。

**あなたのゲームの"主目的"は、「遠征の奥到達（公共指標）」に置きます**。ここが分かりやすいほど、周回の意味が立ちます。その上で、配合とマッチは「奥へ行くための資産形成」に徹し、配合の成果は"強さの単純増加"ではなく、**「選択肢と納得感の増加」** に寄せます。そうしないと、『Dead Cells』が触れているような"死んでアップグレード集める前提"の作業感に落ちやすいからです。

**そして最重要なのは、要素が多いときの失敗パターンである「参照コスト」と「期待の借金」を踏まえ、ローグのコアは一個に固定する**ことです。相談所・遭遇・ボンド・配合の全部を"別ミニゲーム"にしない。全部を「遠征の準備と結果」に吸収し、UIも『Into the Breach』の制約（読みやすさ、メニュー少、短い体験、無駄時間最小化）に従わせる。これを破ると、混ぜ物のコストが表面化して、何が面白いのか伝わらなくなる、という警告がそのまま刺さります。

**最後に、あなたのUI/UX検証方針は正しくて、ここは『Slay the Spire』のように「選択ログを取り、体験を締める」動きが相性抜群です**。具体的には、スワイプ率・詳細閲覧率・ボンド行動の選択比率・配合の確定条件を見たあとに実行した割合・遠征失敗の理由（HP枯渇なのか事故なのか契約破綻なのか）を取れば、面白さの所在が数字で見えてきます。

この再構築に沿うなら、あなたの次の設計の芯は「踏破（公共）＋系譜（個人）＋信用（社会）」で十分で、経営や恋愛シミュまで広げなくても、マッチング的中毒の構造は抽象化して取り込めます。実装難度を上げずにRPGで成立させるなら、ここが最も堅い落とし所です。

共通して言えるのは、**世界のゴールが「一発で救う」ではなく「段階的に構造を改変する」**になっている方が、ローグライク周回と世代交代に自然にハマることです。

## 2.2 面白さの3層構造

この手のゲームは、面白さを混ぜると破綻するため、役割分担します。

### 層1：ラン（ローグライク）での面白さ
- 毎回違う状況での即興ビルド
- リスク管理と撤退判断
- 選択の積み重ねが結果に直結する納得感

### 層2：メタ（世代継承）での面白さ
- 次世代に残す資産の選択（固定化）
- 法則解禁・施設強化・図鑑の拡張で、次ランが"少し"楽になる
- 失敗しても意味が残る

### 層3：ドラマ（マッチング）での面白さ
- 相手（素材）を見つけ、関係を調整し、成立させる過程の快感
- "交渉・共鳴・契約"としての試行錯誤
- たまに起こる大進展（レア成立・事故・特殊条件）

**重要**: マッチングは層3、配合は層2寄りに置き、層1（ラン）の中心にしすぎないことです。ランの最中に配合を中心にするとテンポが死にます。ランは戦略ゲームとして軽快であるべきです。

## 2.3 全体ループ：遠征ローグ × 封印（公共） × 系譜研究（個人） × 相談所（社会）

全体ループを「遠征ローグ × 封印（公共） × 系譜研究（個人） × 相談所（社会）」に再構築します。

### 世界観の設定

主人公（あなた）は「系譜遠征士」あるいは「契約師」で、世界の深層ダンジョンは瘴気で地形も因果も揺らいでいる。世界を救うには深層の"楔（くさび）"を打ち直す必要があるが、人間は奥まで耐えられない。そこで"代替わりする使役獣"を世代交代させながら、少しずつ楔を進めるのが人類の生存戦略で、相談所ビジネスが成立している、という建て付けです。

**重要な線引き**：「子の種族（型）は決定論で、個体プロフィールは一期一会」という方針を、世界観側の"制度"にしてしまうことです。つまり相談所は、個体そのものを売るのではなく「系譜の型」「継承枠の期待値」「事故率保証」「契約条件」を商品として提示する。これなら、同じ個体がいなくても、プレイヤーは"型"で計画でき、個体のユニークさは演出として楽しめます。

### ループ設計（RPGローグライク）

1. **相談所フェーズ（拠点）**
   - **目標設定**：今回の探索目的を選ぶ
     - 封印維持：深層の楔を打ち直す（公共指標）
     - 深層突破：より深い層へ到達する（公共指標）
     - 系譜研究：特定の系譜を発見・完成させる（個人指標）
     - 資源回収：必要な素材を集める
     - 法則解析：配合の法則や事故条件を解明する（知識の継承）
   - **手持ちの整備**：使役モンスターの編成、簡易育成、契約更新の準備
   - **マッチング準備**：相談所の案件（候補リスト）を選別し、"当たり素材"を確保する
     - 相談所は「系譜の型」「継承枠の期待値」「事故率保証」「契約条件」を商品として提示
     - プレイヤーは"型"で計画し、個体のユニークさは演出として楽しむ

2. **探索フェーズ（ラン）**
   - **深層ダンジョン探索**：分岐ノードマップでルートを選択し、部屋単位でテンポよく進行
     - 目標は「深層の楔を打ち直す」ことで、世界の状況（ダンジョンの踏破状況）に直結
   - **ノード種別**：戦闘、イベント、休息、契約、精錬など、各ノードで異なる意思決定を迫る
   - **ダンジョン内マッチング（偶然遭遇）**：希少素材との邂逅、救助、交渉、共鳴イベント
     - 市場では買えない"例外"の獲得（希少タグ、特殊条項、事故の救済、固定レシピのヒント、系譜コアの欠片など）
   - **撤退判断**：常に撤退可能で、持ち帰り資産とリスクを即座に判断できる
     - 撤退が単なる敗北ではなく「得たものは一部持ち帰れるが、目的は未達になり、後始末コストが残る」という現実的な判断
   - 重要なのは「ランの選択」が次の世代資産（知識・選択肢・系譜資産）に変換されること

3. **帰還／崩壊（ラン終了）**
   - 撤退でも全滅でも終わる
   - 収集物・情報・契約進捗が拠点へ持ち帰られる（全部は持ち帰れない）
   - **世界の状況の更新**：ダンジョンの踏破状況（到達階層、封印の楔を打ち直した数など）が更新される
   - **社会指標の更新**：相談所での評判、依頼達成率、事故率などが更新される

4. **継承フェーズ（世代更新）**
   - **次世代の核を作る**：配合で"系譜のコア"を更新（系譜指標の更新）
   - **固定化の枠を決める**：何を永続資産として残すか（知識・選択肢・系譜資産の3層から選択、枠数が少ないのがキモ）
   - **新世代でまた相談所へ戻る**：ループの再開

この構造だと、配合とマッチングは「ランを良くする準備」ではなく、**ランの成果を"次のランが面白くなる形に変換する工程"**になります。主目的は「遠征の奥到達（公共指標）」に置き、配合の成果は"強さの単純増加"ではなく、**「選択肢と納得感の増加」** に寄せます。

## 2.4 マッチングの分業：相談所とダンジョン

### 相談所の役割
- 世界維持（封印）に必要な"適合個体"を調達する市場
- 世代交代する使役体の"系譜の質"が、そのまま相談所の格付けになる
- 相談所が成長すると、候補の質・希少遭遇・契約条項が良くなる（メタ進行）

### ダンジョン内マッチングの役割
- 市場では買えない"例外"の獲得
  - 希少タグ、特殊条項、事故の救済、固定レシピのヒント、系譜コアの欠片など
- つまり「相談所＝安定」「ダンジョン＝尖り」に分業させる

この分業は、プレイヤーに「安定ルートとギャンブルルート」を与えるので、ローグライクと相性が良いです。

## 2.5 永続資産の3カテゴリ（継承の三層）

ランで得た強さをそのまま次ランへ持ち越させない代わりに、次の3種類の資産だけは残します。これは2.1.4で定義した「継承の三層」に対応しています。継承は「能力値の積み上げ」より「選択肢の増加」と「納得できる決定論」に寄せます。

### 1. 知識（情報の継承）

強さではなく"計画性"を上げる資産。『Hades』が言う"ローグでも結局持ち帰るのは知識"を正面からゲーム化します：
- **新しい配合レシピ**：発見した配合レシピが見えるようになる
- **候補の確率**：配合結果の候補確率が見えるようになる
- **事故条件**：事故が発生する条件と回避方法が分かる
- **敵図鑑**：遭遇した敵の情報、弱点、行動パターン
- **遭遇の分岐条件**：特定のイベントが発生する条件
- **相談所の噂**：候補の出やすさ、希少遭遇のヒント

これは強さではなく"計画性"を上げる資産で、ローグライクと相性が良いです。

### 2. 選択肢（手段の継承）

相談所の契約条項の追加、ボンド行動（共同訓練・儀式・交渉）の解禁、ダンジョン内での遭遇プロトコル（奇襲せず交渉できる等）の解禁です。これが増えるほど、周回が"同じことの繰り返し"になりにくい：
- **相談所の契約条項の追加**：次周回で選択できる契約条項が増える（制度の強化）
- **契約枠・推薦枠の増加**：次ランの候補提示が良くなる、希少遭遇が増える、固定枠が少し増える
- **ボンド行動の解禁**：新しいミニゲームや交渉手段が使えるようになる
- **遭遇プロトコルの解禁**：ダンジョン内での新しい遭遇方法が使えるようになる

いわゆるメタ進行の施設強化と、行動選択肢の拡大です。

### 3. 系譜資産（配合の継承）

子の型は決定論、ただし継承枠・特性スロット・事故率・候補スキル幅がボンドや契約で揺れる、という分離方針です。これは『Into the Breach』のように"結果の納得感"を保ちやすい設計です：
- **継承枠の期待値**：次世代に継承できる枠の平均値が上がる
- **特性スロットの解放**：新しい特性スロットが使えるようになる
- **事故率の改善**：配合時の事故率が下がる、または事故の内容が軽くなる
- **候補スキル幅の拡大**：継承できるスキルの種類が増える
- **初期タグの確定**：次世代の初期タグが確定する

次世代の使役体の"核"だけ残すが、ただし「強さ」ではなく「選択肢の広さ」を残します。

これで、ランの緊張感は守りつつ、周回の意味は残ります。失敗周回でも「自分は確実に上がっている」感が出て、ループが続きます。

## 2.6 「一期一会の演出」と「再現性のある法則」の分離

このプロトタイプでは、候補の見え方はユニークなプロフィールとして提示しますが、配合の"子の種族"は決定論で予測できるようにし、マッチング要素が影響するのは「継承の質」「候補スキルの並び」「事故率」「ボンドによる追加枠」など、ビルド側に限定します。これにより、アプリ的な出会いの気分を保ちつつ、配合の計画性を壊しません。

## 2.7 予測可能性の担保

ユーザーが次の行動を選べるように、配合プラン画面では「この2体なら子候補はこれ」「成立条件はこれ」「ボンドが高いと何が増える」を事前に見せます。ランダム性を入れる場合でも、候補は2〜3択に絞り、確率を明示します。

## 2.8 反復行動を疲れさせない

スワイプはテンポが命なので、カード操作は一画面内で完結し、詳細はモーダルに逃がします。配合は慎重な行為なので、確認ダイアログと戻る導線を厚くします。取り逃しストレスを減らすため、候補の「最近見た」「あとで見る」も用意します。

# 3. 主要ユーザーと利用シナリオ

## 3.1 想定ユーザー

主な対象は、配合で“狙って作る”計画が好きな人と、コレクションの回遊が好きな人です。前者は「結果の予測」「素材の管理」「比較表示」に敏感で、後者は「出会いの演出」「収集ログ」「ちょっとした意外性」に反応します。

## 3.2 主要シナリオ

第一のシナリオは、ユーザーが目標種族（または目標ビルド）を設定し、それに近い候補素材をスワイプで集め、ボンドを上げ、配合プランで結果を確認して実行し、結果の納得感を得る流れです。第二のシナリオは、目的を決めずに探索して、意外なマッチや特殊配合ヒントを拾い、収集の気持ちよさで回す流れです。

# 4. 情報設計とナビゲーション

## 4.1 画面構成

本プロトタイプの画面は、ホーム、相談所（受付）、ディスカバー（スワイプ）、マッチ一覧、ボンド（関係値）画面、配合プランナー、配合結果、コレクション（所持一覧）、設定で構成します。情報の粒度として、スワイプは「軽い情報」、配合は「重い情報」を基本とし、同じ情報を両方に入れないようにします。

**重要な変更**: 「探す」「マッチ」「配合」の3つの機能は、すべて「相談所」という統合画面からアクセスします。相談所は世界観上、系譜遠征士や契約師が使役獣を調達する拠点であり、受付の人が各機能への案内を行います。

## 4.2 グローバルナビゲーション

スマホは下部タブ、PCは左サイドバーを基本にします。タブは「相談所」「所持」とし、設定は右上のメニューに格納します。「探す」「マッチ」「配合」は相談所内の機能として統合され、下部タブから直接アクセスすることはできません。これにより、世界観の一貫性を保ちつつ、ユーザーが相談所を「拠点」として認識しやすくなります。

# 5. 画面設計

ここからは各画面の目的、レイアウト、操作、主要状態を定義します。ワイヤーの代わりに、配置と優先順位を文章で固定します。

## 5.0 相談所（拠点フェーズ）

相談所は、系譜遠征士や契約師が使役獣を調達する拠点です。世界観上、深層ダンジョン探索に必要な使役獣の契約、配合、管理を一手に引き受ける施設として機能します。この画面は、ラン開始前の準備とマッチング準備を行う拠点画面であり、受付の人がプレイヤーを各機能へ案内します。

### 5.0.0 相談所の受付画面

相談所に入ると、まず受付の人がプレイヤーに「どのようなご用件でしょうか？」と質問します。プレイヤーは以下の3つの選択肢から選びます：

1. **候補を探す（探す機能）**: 相談所の案件（候補リスト）から"当たり素材"を探す。スワイプまたは一覧から選択してマッチ成立を目指す。
2. **マッチを確認する（マッチ機能）**: 既に成立したマッチの一覧を確認し、ボンドを上げるミニセッションに進む。
3. **配合を計画する（配合機能）**: 配合プランナーで、親個体を選択し、子の種族と継承をプレビューして配合を実行する。

**世界観の説明**: 受付の人は「どのような使役獣をお探しですか？」「契約の進捗はいかがですか？」「新しい個体を生み出す準備はできていますか？」といった自然な問いかけで、各機能への導線を提供します。

**UI設計**: 
- 受付の人のイラストまたはアバターを中央上部に配置
- 3つの大きなボタンカードを縦に並べ、それぞれにアイコンと説明文を添える
- 各ボタンをタップすると、対応する画面（探す、マッチ一覧、配合プランナー）に遷移
- 画面下部に「相談所の成長とメタ進行」の情報を軽く表示（ランク、契約枠、推薦枠など）

### 5.0.1 マッチング準備（相談所の案件）

「候補を探す」を選択すると、探す画面（5.2）に遷移します。相談所の案件（候補リスト）を表示し、"当たり素材"を確保します。ここでのマッチングは「安定ルート」で、市場で調達できる候補を選別します。

- **候補リスト**: 相談所の格付けに応じた候補が表示される
- **フィルタ**: 目標に合わせたフィルタリング（種族、位階、タグ、推奨条件など）
- **マッチング**: スワイプまたは一覧から選択してマッチ成立
- **マッチ後セッション**: 相談所でのマッチング後も、ミニゲームによる好感度とパラメータ開示が可能

### 5.0.2 マッチ確認（マッチ一覧）

「マッチを確認する」を選択すると、マッチ一覧画面（5.4）に遷移します。成立したマッチの一覧を確認し、ボンドを上げるミニセッションに進みます。

### 5.0.3 配合計画（配合プランナー）

「配合を計画する」を選択すると、配合プランナー画面（5.6）に遷移します。親個体を選択し、子の種族と継承をプレビューして配合を実行します。

### 5.0.4 相談所の成長とメタ進行

相談所のランク、契約枠、推薦枠などのメタ進行状況を表示します。これらは周回をまたいで保持され、次ランの候補提示の質や希少遭遇率に影響します。受付画面の下部に軽く表示し、詳細はタップで展開できるようにします。

## 5.1 ホーム（ダッシュボード）

ホームは「今日の行動の入口」と「目標の見える化」を担います。ただし、ホームが「内部パラメータのダッシュボード」ではなく「世界の状況と次の一手を示す司令室」として機能するよう、情報設計を「状況 → 証跡 → 詳細」の順に並べ替えます。

**注意**: 自キャラクターは一体のみ保有でき、複数所持の概念はありません。配合で新しい個体を獲得した場合、自キャラクターが置き換わります（転生ループでは、自キャラクターもリセットされます）。

### 5.1.1 情報設計の3層構造

ホームの情報は、重要度と表示順序を明確に分けます：

#### 第一層：世界の状況（要約）

最上段に「世界の状況」を1つのカードにまとめます。数値的なメトリクスではなく、ダンジョンの踏破状況から読み取れる世界の状態を表現します。

- **総合状態のラベル**: ダンジョンの踏破状況から判断した状態ラベルを表示
  - 例：「封印は安定」（最深部の楔を打ち直した後）、「封印が揺らいでいる」（中層まで到達）、「臨界」（浅層に留まっている）
- **次の遠征で何をすべきか**: 状態ラベルの下に短い一文で「次の遠征で何をすべきか」を言い切る
  - 例：「次の楔まであと1層」「最深部の封印を打ち直す必要がある」「中層の探索を進める」
- **ダンジョンの進行状況**: 到達階層、達成した目標、封印の状態などを表示（数値ではなく、物語的な表現で）

**用語の翻訳**: 現実アプリ語彙を世界内用語に置き換えます。
- 「いいね残量」→「本日の調停回数」「紹介状」「契約申請枠」
- 「素材数」→「保管庫」「契約候補」「保有素材」
- 「交配回数」→「系譜更新回数」
- 「マッチング数」→「契約成立数」

#### 第二層：直近の出来事（証跡）

画面下部に直近の配合結果と直近のマッチ成立を「出来事のログ」として表示します。カード一覧ではなく、1行で成果と意味を添えます。

- **出来事の形式**: 「○○と契約成立（継承枠+1の見込み）」「交配で××が誕生（封印適合タグが揃った）」など、1行で成果と意味を表示
- **タップで詳細**: 各出来事をタップすると、該当の詳細（マッチ詳細や履歴詳細）へ遷移
- **時系列表示**: 直近の出来事を時系列で表示し、続きから再開できるようにする

#### 第三層：詳細（数字の内訳）

数字の詳細は折りたたみで配置し、必要に応じて展開できるようにします。

- **永続資産の詳細**: 転生ループで周回をまたいで残る「永続資産（知識/制度/系譜コア）」の詳細
  - **知識（法則・テーブルの解像度）**: 新しい配合レシピ、候補の確率、事故条件の情報。計画性を上げる資産として表示
  - **制度（相談所・契約枠・推薦枠）**: 相談所のランク、契約枠、推薦枠、候補提示の質、希少遭遇率。メタ進行の施設強化として表示
  - **系譜コア（次世代の初期条件）**: 継承枠、スロット、初期タグの確定。次世代の選択肢の広さとして表示
- **自キャラクターの詳細**: 自キャラクターカードをタップすると詳細情報（スキル、ステータス、マッチ履歴など）を表示
- **進行状況の詳細**: 現在の進行状況（何周回目か、次のボスは何か）、次のボスに必要なビルド要件

これにより、失敗周回でも「自分は確実に上がっている」感が出て、ループが続きます。

### 5.1.2 UIデザインの方針

#### カードの色とアイコンの統一

カードごとに強い色分け（`Colors.green.shade50` や `Colors.blue.shade50` など）を避け、Material 3 の `theme.colorScheme.*Container` を使って、彩度の低い統一トーンに寄せます。色で分類するのではなく、分類は見出しとアイコンで行い、色は全体の雰囲気を壊さない程度に抑えます。

#### 見出しの世界観統一

見出しの「世界の目標（公共指標）」「永続資産（三層構造）」のような括弧付きの説明は、世界内では誰も言わないのでホームからは外し、詳細画面やヘルプに回します。ホームでは「世界の状況」「継承の記録」「相談所の格付け」など"世界内ラベル"に寄せます。

#### 設計意図の説明の退避

カード内にある「リセットされるもの／残るもの」や「モンスターの強さは周回で揺れる…」のような設計意図の説明は、プレイヤー向けのデザイン解説なので、世界観を割ります。これらはカード内からは消して、右上の「i」ボタンや「ヘルプ」モーダルに退避します。UI/UX検証として残したい場合は、設定に「開発者表示（数値と設計注釈）」トグルを作って、オンのときだけ出す形にします。

### 5.1.3 ローディングと初回体験

ローディング時は骨組み表示にし、初回はツアーをモーダルで出します。ツアーは一回で終わる長文ではなく、「探す」「配合」の2ステップ程度に留めます。

## 5.2 探す（ディスカバー／スワイプ）

探す画面は、相談所フェーズでのマッチング準備を担います。中心は一枚の候補カードで、カードには「種族（型）」「位階（またはレベル帯）」「主要タグ（最大3）」「ひとことプロフィール（フレーバー）」を載せます。カード下に操作ボタンを置き、左がスキップ、右がいいね、中央が詳細、右上に「あとで見る（ブックマーク）」を置きます。スマホは左右スワイプでスキップ/いいね、上スワイプでブックマーク、タップで詳細表示にします。PCはドラッグ、左右キー、A/Dキーで同等操作を提供します。

**注意**: この画面は「相談所＝安定」ルートのマッチングです。ダンジョン内での偶然遭遇（希少素材との邂逅、救助、交渉、共鳴イベント）は、探索フェーズ（ラン）内のイベントとして別途実装されます。

### 5.2.0 パラメータの段階的表示（4層構造）

候補カードには、パラメータを4層に分けて段階的に表示します。これは「スクリーニングに必要な情報」と「マッチ後に深掘りする情報」を分離し、フィルタと矛盾しない開示の段階を用意するためです。

#### 第一層：公開情報（最初から開示）

スワイプ段階で「会う価値があるか（スクリーニング）」の判断に必要な情報は、最初から完全に開示します。これらを隠すと検索やフィルタが崩れ、ゲームが面倒になります。

**開示される情報**：
- **種族（型）**: 完全に表示
- **位階（格）**: 完全に表示
- **ロール（アタッカー/サポート等の粗い役割）**: 完全に表示
- **主要タグ2〜3個**: 完全に表示
- **致命的な拒否条件**: 必ず表示
  - 継承不可の大分類
  - 契約不能級の性質
  - 「この相手と組むと配合そのものが成立しない」「事故がほぼ確定する」などの地雷情報

**UI表示**: 通常のテキスト表示として、明確に表示します。

#### 第二層：準公開情報（推定表示）

最初は曖昧に見せて、マッチ後に確定させる「準公開情報」です。強さに直結するが、即決に必須ではない情報を、推定表示として提示します。

**表示される情報**：
- **耐性や弱点**: 「氷耐性：ありそう（未確認）」「火弱点：可能性あり（要確認）」
- **継承の得意分野**: 「支援適性：高め（推定）」「攻撃継承：やや苦手（推定）」
- **パッシブ傾向**: 「回復寄り（推定）」「バフ寄り（推定）」

**UI表示**: 
- 推定値として表示し、「要確認」バッジやアイコンを付与
- フィルタでは「不明を含める（要確認）」スイッチを常設し、不明な候補も候補として表示（未確定であることを明示）
- 候補カード側では「要確認：氷耐性」「要確認：状態異常耐性」のように、会話すれば確定できる項目をピンで表示

**マッチ後の確定**: マッチ後のミニゲームで「確定」へ落とします。これにより、フィルタ側は推定値で引っ掛けられる一方、確度を上げたい人は会話（セッション）を回す理由ができます。

#### 第三層：深掘り情報（マッチ後の試行錯誤で開示）

マッチ後の試行錯誤でしか出ない「深掘り情報」です。ここが"会話で知っていく快感"の本丸で、なくても攻略はできるが、あると気持ちよく強くなる位置づけにします。

**開示される情報**：
- **隠しタグ**: 実は相性が極端に良い/悪いタグ
- **事故率に影響する気質**: 特殊な配合での事故率変動
- **継承候補スキルの上位枠**: 通常は見えない高レアスキルの候補
- **特殊配合のヒント**: 特定の組み合わせで発動する特殊配合の手がかり
- **真名（トゥルーネーム）の断片**: 世界観的な特別感を持つ情報

**UI表示**: 
- マッチ後セッションの進行に応じて、段階的に開示
- 開示された情報は、配合プランナーのプレビューに即座に反映
- 「新しく判明した情報」として差分表示で強調

#### 第四層：サプライズ情報（最後まで隠すか確率で見える）

意図的に最後まで隠すか、あるいは確率でしか見えない「サプライズ情報」です。ガチャの高揚感に相当する層で、数を絞って"当たった時は明確に得"にします。

**開示される情報**：
- **盟約条項が1枚増える**: 通常2〜3択のところ、3〜4択になる
- **継承枠の上限が一時的に+1**: 配合時の継承枠が増加
- **事故テーブルが良化**: 事故率が下がる、または事故の内容が軽くなる
- **特殊な継承パターンの解放**: 通常は継承できない組み合わせが可能になる

**UI表示**: 
- サプライズ情報が開示されたときは、特別な演出（エフェクト、音、アニメーション）を表示
- UI上で成果がはっきり見えるご褒美として表示
- デメリットは含めない（デメリットは第二層か第三層で回避可能な形で見せる）

**重要**: サプライズ情報に"致命的なデメリット"を入れると理不尽に感じられやすいので、デメリットは第二層か第三層で回避可能な形で見せるほうが安定します。

### 5.2.1 目標への貢献度と道中ボス連携

この画面で重要なのは、「この候補が配合計画にどう効くか」を軽く匂わせることです。そこでカードの下部に「あなたの目標への貢献度」を一行で出します。例として、「目標タグ"氷耐性"の素材になりやすい」「相性が良いのでボンド効率+10%」のような短い文にします。ここで配合結果そのものを出し始めるとスワイプが重くなるので、あくまで行動の背中押しだけに留めます。

また、現在の進行状況（次のボス）に応じて、「この候補が次のボス攻略にどう効くか」も軽く示します。例：「次のボスに有効な『状態異常耐性』タグを持っています」。

### 5.2.2 格上からの承認演出

候補カードに"格（位階）"と"到達難易度（あなたの名声で成立率が上がる）"をうっすら示しつつ、あえて時々だけ「今の名声では普通は成立しない格上」が流れてくる枠を作ります。この枠が成立したときは：
- **成立演出を別格に**: 通常のマッチ成立より派手な演出（エフェクト、音、アニメーション）
- **実利の付与**: 成立演出と同時に、実利として以下を表示
  - 「盟約条項が1枚多い」
  - 「継承枠の上限が一時的に+1」
  - 「事故テーブルが良化」
- **天井（ピティ）の表示**: UI/UX検証なら、内部実装が簡易でも「あと何回で格上枠が出やすくなる」などの表示だけで体験差が作れます

単に成立率を低くするだけだと不快になるので、周回内あるいは周回跨ぎで「天井」を薄く仕込み、プレイヤーが「自分の判断で格上に届いた」と感じる余地を残します。

### 5.2.3 状態管理

状態として、いいね残量がゼロになったら、カードの上に「本日はこれ以上いいねできません」を明示し、右ボタンを無効化します。その代わりに「スキップ」「あとで見る」「配合へ」導線は残し、行動停止にならないようにします。

## 5.3 候補詳細（プロフィールモーダル）

詳細はモーダルか別画面で、上から「見た目」「種族と位階」「タグ一覧」「相性理由」「所持スキル候補（UI上の仮）」「注意点（継承不可など）」を並べます。ここでは相性がブラックボックスに見えないように、「一致タグ」「相補タグ」「衝突タグ」を短い説明で見せます。ただし数式は出しません。数式は一部の人しか喜ばず、残りは逃げます。

モーダル下部に「いいね」「スキップ」「ブックマーク」「通報（冗談機能でも良いがUIの逃げ道として）」を置きます。

## 5.4 マッチ一覧

マッチは「成立したペア」と「次にやること」を管理する画面です。リストには、相手個体カード、成立日時、現在ボンド、推奨アクション（例：ボンドを上げる、配合プランに追加する）を表示します。各行を開くと、ボンドを上げるミニセッションに遷移でき、配合プランナーに“素材として送る”ボタンも用意します。

未読の新規マッチがあるときはタブにバッジを出し、通知はブラウザ通知ではなくアプリ内通知だけにします。UI/UX検証目的なら通知は過剰になりやすく、体験を濁します。

## 5.5 マッチ後セッション（ミニゲームによる好感度とパラメータ開示）

マッチ成立後の試行錯誤を、配合の成否を左右する"行動"にするため、単なるボンドゲージ上げではなく「短いミニゲームの連鎖」として実装します。現実の「会話→デート→交際」を抽象化し、「マッチングアプリやその後のデートでの会話で、プロフィールに記載されていない情報を得ていくプロセス」を再現します。

### 5.5.0 好感度システムとパラメータ開示の基本設計

#### 好感度の役割

好感度は、マッチ後のミニゲームで積み上げていく値です。好感度が高いほど：
- パラメータの開示が進む（第二層→第三層→第四層）
- 配合プランナーでの有利な条件が解放される（継承枠増加、事故率低下など）
- 盟約条項の選択肢が増える

#### 好感度が下がり過ぎた場合

好感度が一定値以下になると：
- **完全ロストは避ける**: プレイヤーの学習の場を残すため
- **契約保留（一定時間マッチ一覧から消える）**: 一時的にマッチ一覧から消えるが、一定時間後に再交渉可能
- **再交渉に必要なコストが増える**: 次回のミニゲームで必要な好感度の閾値が上がる

これにより、「会話を通じて、好感度が下がり過ぎると切られて連絡がつかなくなる」緊張感を再現しつつ、失敗しても次に活きる学習の場を残します。

#### パラメータ開示のタイミング

ミニゲームの成功度に応じて、段階的にパラメータが開示されます：
- **第二層（準公開情報）の確定**: ミニゲーム1回目で確定
- **第三層（深掘り情報）の開示**: ミニゲーム2〜3回目で段階的に開示
- **第四層（サプライズ情報）の開示**: 確率で、または好感度が一定値以上で開示

### 5.5.1 ミニゲームの種類と実装方法

マッチ後のセッションでは、以下の5種類のミニゲームから、ランダムまたは好感度に応じて選択されます。各ミニゲームは10〜30秒で終わり、2〜3回回すと何かが確定する軽さを目指します。

#### 5.5.1.1 契約交渉（会話カード）型

**世界観**: 契約交渉の場面。相手個体との交渉を通じて、条件を詰めていく。

**UI**: 会話っぽく見せ、選択肢は「条件提示」「利益提示」「譲歩」「確認質問」のように交渉語にします。

**ゲームプレイ**:
- 選択肢カードを4枚提示
- プレイヤーが1枚を選択
- 選択したカードの種類によって、開示されるカテゴリが変わる：
  - **確認質問**: 耐性や継承制限の確定に強いが好感度が伸びにくい（+2〜+5）
  - **利益提示**: 好感度が伸びやすいが情報は開きにくい（+8〜+12、情報開示は少なめ）
  - **条件提示**: 狙い候補の確率寄せが進むが失敗すると好感度が落ちやすい（+5〜+10、失敗時-3）
  - **譲歩**: 好感度が中程度伸び、情報開示も中程度（+5〜+8）

**フィードバック**: 選択後に「氷耐性が確定」「衝突タグが判明」「好感度+8/−12」など短いフィードバックを即返し、その結果が配合プランナーのプレビューに反映されます。

**開示される情報**: 第二層（準公開情報）の確定、第三層（深掘り情報）の一部

#### 5.5.1.2 共鳴調律（パズル）型

**世界観**: 相手の"波形"にこちらを合わせる短い調整ゲーム。世界観的には「魂の周波数を合わせる」「魔力の位相を揃える」で説明できます。

**UI**: 波形を視覚的に表示し、プレイヤーがボタン操作で波形を作成・合成します。

**ゲームプレイ**:
- 相手の目標波形（合成波）が表示される
- 目標波形の数は相手キャラクターの位階に応じて決定される（位階が高いほど波形数が増える）
- プレイヤーは複数の波形コンポーネントを作成し、それらを合成して目標波形に再現する
- 目標波形とプレイヤーの合成波形は同じ図上に表示され、比較しやすい
- 合成された波形と目標波形の一致度で成功度が決まる
- 成功度は「完璧」「良好」「普通」「失敗」の4段階

**波形コンポーネントのパラメータ**:
- **強度（1～3）**: 振幅の大きさを決定（強度が高いほど振幅が大きい）
- **テンポ（周期）**: スライダーで調整する波形の周期（0.5～3.0秒、0.5秒刻み）

**波形の作成方法**:
- 強度1～3を選択
- テンポをスライダーで調整（0.5～3.0秒の範囲で0.5秒刻みで調整可能）
- 強度とテンポの欄にある「波形を追加」ボタンを押下すると、選択中の強度とテンポで波形コンポーネントが追加される
- 複数回ボタンを押すことで、複数の波形コンポーネントを追加できる
- 追加された波形コンポーネントは自動的に合成され、合成波形が表示される
- 各波形コンポーネントの強度とテンポは一覧に表示され、各波形に「-」ボタンが配置されて削除可能

**位階に応じた波形数**:
- 初級/D/E: 2個
- 中級/C: 3個
- 上級/B: 4個
- 最上級/A: 5個
- S/SS: 6個

**フィードバック**: 
- 成功度に応じて好感度が変動（完璧:+15、良好:+10、普通:+5、失敗:+0）
- 確定したパラメータを表示（例：「氷耐性が確定」「継承適性が判明」）

**開示される情報**: 第二層（準公開情報）の確定、第三層（深掘り情報）の一部

#### 5.5.1.3 儀式手順（記憶・順序）型

**世界観**: 相手の好む儀式の段取りがあり、それを短い順序ゲームで再現します。

**UI**: 儀式の手順を視覚的に表示し、プレイヤーが順序を記憶して再現します。

**ゲームプレイ**:
- 相手の好む儀式の手順が3〜5ステップで表示される（数秒間）
- 手順が消え、プレイヤーが同じ順序で再現する
- 成功すると好感度と"真名の断片"が手に入る
- 失敗すると好感度が微減するが「次はこの順序が良い」というヒントが残る

**フィードバック**: 
- 成功時: 好感度+10〜+15、「真名の断片を獲得」「儀式の好みが判明」
- 失敗時: 好感度-2〜-5、「次回のヒント: この順序が良い」

**開示される情報**: 第三層（深掘り情報）の一部、特に「真名の断片」などの世界観的な情報

#### 5.5.1.4 贈与/供物の調合（選択）型

**世界観**: デートの"プレゼント"を、世界観では「供物」「触媒」「素材の精製」に置換します。

**UI**: 候補となる供物/触媒/素材を複数提示し、プレイヤーが2つを選択します。

**ゲームプレイ**:
- 候補から4〜6個の供物/触媒/素材を提示
- プレイヤーが2つを選択して相手に提示
- 相手の嗜好タグに合うと好感度が大きく伸び、同時に嗜好タグが確定する
- 格上個体ほど要求が難しいが、当たるとリターンが大きい

**フィードバック**: 
- 嗜好に合致: 好感度+12〜+20、「嗜好タグが確定」「相性が向上」
- 嗜好に合わない: 好感度+3〜+5、「嗜好の手がかりが得られた」

**開示される情報**: 第三層（深掘り情報）の一部、特に「嗜好タグ」「相性タグ」

#### 5.5.1.5 同行試練（短い判断）型

**世界観**: 会話に見せずに、「この状況でどう判断するか」という二択三択を出して、相手の価値観タグを確定させる方式。世界観の説明は「契約者の資質を試す」「相棒としての判断を見る」で十分通ります。

**UI**: 状況説明と選択肢を提示し、プレイヤーが判断を選択します。

**ゲームプレイ**:
- 短い状況説明を提示（例：「敵が迫っている。どうする？」）
- 2〜3択の判断を選択
- 相手の価値観タグに合うと好感度が伸び、価値観タグが確定する
- 恋愛っぽさを完全に排除しながら「相手の内面を知る」プロセスを作る

**フィードバック**: 
- 価値観に合致: 好感度+10〜+15、「価値観タグが確定」「信頼が深まった」
- 価値観に合わない: 好感度+2〜+5、「価値観の手がかりが得られた」

**開示される情報**: 第三層（深掘り情報）の一部、特に「価値観タグ」「気質」

### 5.5.2 セッションの流れ

マッチ後のセッションは、以下の流れで進行します：

1. **セッション開始**: マッチ成立後、またはマッチ一覧から「ボンドを上げる」を選択
2. **ミニゲーム1回目**: 5種類のミニゲームから1つを選択（ランダム、または好感度に応じて）
   - 第二層（準公開情報）の確定が進む
   - 好感度が初期値から変動
3. **フィードバック表示**: 開示された情報と好感度の変化を表示
4. **配合プランナーへの即座反映**: 開示された情報が配合プランナーのプレビューに反映（差分表示）
5. **ミニゲーム2回目（任意）**: 好感度が一定値以上の場合、続けてミニゲームを実行可能
   - 第三層（深掘り情報）の開示が進む
6. **ミニゲーム3回目（任意）**: 好感度がさらに高い場合、3回目も実行可能
   - 第三層（深掘り情報）のさらなる開示、または第四層（サプライズ情報）の開示
7. **セッション完了**: 最終的な好感度、開示された情報、配合プランナーへの反映内容を表示

### 5.5.3 盟約（コミット）の選択

好感度が一定値以上に達した場合、またはセッション完了時に「盟約」として、トレードオフ付きの条項を2〜3枚（好感度が高い場合は4枚）提示し、プレイヤーに選ばせます。

**条項の例**：
- 「継承枠を増やす代わりに事故率が少し上がる」
- 「狙い候補Aの確率を上げる代わりに別候補Bの確率が下がる」
- 「タグ継承を安定させる代わりにスキル継承の幅が狭まる」
- 「事故テーブルが良化する代わりに継承枠が1減る」

**反映**: 条項を選んだ瞬間に、配合プランナーの数値と条件表示が変わるようにします。これにより、マッチ後の試行錯誤が"作業"ではなく"プランニングの一部"になります。

### 5.5.4 セッション完了とフィードバック

セッション完了時、以下の情報を表示します：
- 最終的な好感度（ボンド値）
- 開示されたパラメータ（第二層、第三層、第四層それぞれで何が開示されたか）
- 選択した盟約条項とその効果（選択した場合）
- 配合プランナーへの反映内容（差分表示）

ここでのUX要点は、ボンドが「何に効くか」が毎回確認できることです。ゲージだけ上がっても人は納得しないので、必ず効果に紐づけた短文を添えます。

### 5.5.5 フィルタとの連携

「隠し過ぎるとフィルタから漏れる」問題を解決するため、フィルタには「不明を含める（要確認）」スイッチを常設します。これにより：
- 不明な候補も候補としては表示されるが、未確定であることが明示される
- 候補カード側では「要確認：氷耐性」「要確認：状態異常耐性」のように、会話すれば確定できる項目をピンで表示
- スクリーニングと深掘りの導線が繋がる

つまり、隠すのではなく「未確定として見える」状態を作ります。

## 5.6 配合プランナー

配合プランナーは最重要画面で、計画性と納得感を担います。上段に「親A」「親B」のスロットを置き、所持一覧やマッチ一覧からドラッグまたは選択で入れます。中段に「子の種族プレビュー」を大きく表示し、ここは決定論で固定します。もし候補が複数になる設計なら、最大3体までを横並びで出し、それぞれに確率と"確定させる条件（ボンドやタグ）"を添えます。下段に「継承プレビュー」を置き、継承枠数、候補スキル、注意点、事故率（任意）を表示します。

### 5.6.1 未達条件と条件達成によるプレビュー変化

マッチ後セッションの各ターンで「何が改善されたか」を必ず一行で返し、その改善がプランナーの「候補確率」「継承枠」「事故率」「確定条件」のどれに効いたかを、差分表示で即時に見せます。具体的には：
- **未達条件の表示**: 現在のプランで「まだ満たしていない条件」を明示（例：「共鳴値が50未満のため、候補Aの確率が30%」「盟約条項未選択のため、継承枠が基本値のまま」）
- **条件達成による変化**: マッチ後セッションで条件が達成されると、プランナーのプレビューがリアルタイムで更新される（例：「共鳴値が50に到達！候補Aの確率が30%→60%に上昇」「盟約条項『継承枠+1』を選択。継承枠が3→4に増加」）

これにより、現実のアプリが「返信が来た」「会話が続いた」「次に進めた」で回るのと同じで、このプロトタイプでは「条件が進んだ」「確率が寄った」「枠が増えた」で回せます。

### 5.6.2 差分表示（比較機能）

この画面には「比較」が必要です。同じ親Bで親Aだけ差し替えたときに、子の種族と継承がどう変わるかを見たいので、「直前のプランと差分表示」を用意します。差分は色ではなく、プラスマイナス記号と短文で表現します。色だけに頼るとアクセシビリティが落ちます。

また、マッチ後セッションの進行に伴う変化も差分表示で示します。セッションの各段階（交渉、共鳴調律、盟約）で、プランナーの数値がどう変わるかをリアルタイムで可視化します。

### 5.6.3 道中ボスとの連携（要求ビルドの提示）

戦闘が自動で敵が段階的に強くなるなら、マッチングと配合が"攻略の前提"になっている必要があります。そこで道中ボスごとに「要求されるビルド」が変わるように見せます。プランナー画面に「現在の進行状況」と「次のボス」を表示し、ボスごとに「推奨タグ」「推奨耐性」「推奨ロール」を自然言語で提示します。例：
- 「次のボスは状態異常が苛烈です。『状態異常耐性』タグを持つ個体を推奨します」
- 「単体高火力のボスです。『タンク』ロールの個体を推奨します」

プレイヤーはスワイプで素材を集め、マッチ後セッションで"狙い候補に寄せる条件"を満たし、配合でビルドを作り、オート戦闘で検証する、という循環ができます。勝敗が自動で決まる分、プランの正しさがそのまま結果に反映されるので、学習が早く、繰り返しが気持ちよくなります。

### 5.6.4 配合実行と確認

配合の実行ボタンは、最下部に固定し、押下時に確認ダイアログを出します。確認ダイアログには「消費される親」「得られる子」「戻れない」だけを簡潔に出し、詳細は「内訳を見る」で折りたたみにします。確認が冗長だとテンポが死に、確認が薄いと後悔が増えます。ここは人間の自己責任感と後悔耐性のバランス取りです。

## 5.7 配合結果

結果画面は「成功の祝祭」と「次の行動」だけに絞ります。上部に新個体カードを大きく表示し、獲得した種族、主要タグ、継承スキルを見せます。その下に「今回の配合がこうなった理由」を短く説明します。例として、「種族結果はA×Bの法則により固定」「ボンドが高かったため継承枠が1増加」のように、納得材料を置きます。

**重要**: 配合で新しい個体を獲得した場合、**自キャラクターが置き換わります**。自キャラクターは一体のみ保有できるため、新しい個体が自キャラクターになります。画面には「新しい自キャラクターになりました」という表示を出し、置き換えが明確に分かるようにします。

最後に、「次のおすすめ」として「この子を目標に設定」「この子でさらに配合」を並べます。結果から次の行動へ自然に流れることが、反復の体験を支えます。

## 5.8 所持一覧（コレクション）

所持一覧は「素材管理」と「愛着」の二役を担います。**注意**: 自キャラクターは一体のみ保有でき、複数所持の概念はありません。自キャラクターはホーム画面で確認でき、所持一覧には表示しません（または、特別な表示として「自キャラクター」として表示する）。

上部に検索とフィルタを置きます。フィルタは、種族、位階、タグ、ボンド状態（マッチ中、候補中）、ロック状態（保護）を想定します。リスト表示はカード型で、配合プランに追加する導線を各カードに付けます。ロックは誤消費防止のため必須で、ロックした個体は配合スロットに入れようとすると警告を出します。

## 5.9 深層ダンジョン探索

深層ダンジョン探索のUXは、「毎回違うのに、毎回"納得して負けられる"」を作るのが仕事です。配合とマッチングが"ランの外側（世代継承）"にあるため、探索は徹底して読みやすく、迷わせず、無駄時間を削る方向が向いています。Into the Breachが掲げた「読みやすさ・メニューの少なさ・無駄時間の最小化・短い体験・面白い選択」といった制約は、そのまま深層探索UXの設計指針にできます。

### 5.9.1 探索の基本構造：分岐ノード＋部屋単位

RPG型（非アクション）でローグをやるなら、探索の気持ちよさは「移動の操作感」ではなく「次に何を踏むかの選択」で出します。マップは自由歩行グリッドより、Slay the Spireのような"分岐ノードマップ"寄りが強いです。分岐があるだけで、同じ戦闘でも意味が変わり、ルート選択がメタ的な上達（学習）に直結します。

**ノード種別**：
- **戦闘ノード**：敵との戦闘（自動戦闘）
- **イベントノード**：選択肢があるイベント
- **休息ノード**：回復やデッキ調整に相当する整理
- **契約ノード**：ダンジョン内マッチング（偶然遭遇）
- **精錬ノード**：資源の変換や強化

そのうえで、ノードを選んで入った先は"部屋（ルーム）単位"のテンポにするのが良いです。Hadesがやっている「部屋→報酬→次の扉」という短いループは、反復を苦痛にしにくい構造です。

**UXとして**：「全体は分岐ノードで計画、局所は部屋でテンポ」の二段構えにすると、深層探索が重くならず、しかも"次の一手"が常に明確になります。

### 5.9.2 探索画面のHUD設計

深層探索が面白いローグは、だいたい"押し込むか撤退するか"を毎回迫ってきます。Darkest Dungeonが強いのは、撤退が単なる敗北ではなく「得たものは一部持ち帰れるが、目的は未達になり、後始末コストが残る」みたいな"現実的な判断"になる点です。

**探索画面の常時表示（HUD）を、次の3つに絞る**：

1. **生存資源**：HPや回復回数など、現在の生存可能性を示す情報
2. **継続リスク**：ストレス/汚染/崩壊度のような増えるほど不利なゲージ
3. **持ち帰り資産**：今回のランで"銀行に入った"分と"未精算で落とす"分

**撤退ボタン**：常に見せ、撤退時に何が持ち帰れ、何を失うかを即座に読めるようにします。これがあると、周回の緊張感を保ったまま"死んでも学べる"手触りが作れます。

ここを分けるだけで、撤退判断が"気分"ではなく"計算"になります。

### 5.9.3 ノード（部屋）の情報設計

Spelunkyの分析では、ローグのランダム性は"理不尽"ではなく、プレイヤーが個別状況の反復練習ではなく「構造やルールを学ぶ」方向に学習が移ることが重要だ、という整理がされています。

個体が一期一会である以上、探索UXは「個別ケース暗記」ではなく「判断の型を学べる」ように作るべきです。

**ノード表示の最低限**：
- **部屋種別**：戦闘/イベント/休息/契約/精錬など
- **報酬カテゴリ**：資源/情報/系譜素材/契約条項
- **危険度**：低/中/高

一方で中身を完全に開示すると作業化するので、イベントは"選択肢があること"だけ見せ、詳細は入ってから分かる程度がちょうどいい。

**重要なのは、入った後の提示が分かりやすいこと**：Into the Breachが強い"読みやすさ"の思想に寄せて、イベントの結果は「何が増え、何が減り、なぜそうなったか」を短文で返します。

### 5.9.4 マッチング要素の統合

探索中にマッチング要素を入れる場合、最大の失敗は"探索が止まる"ことです。だから置き場は2つしかありません。

#### 休息（キャンプ）ノードに寄せるやり方

休息ノードでは回復やデッキ調整に相当する整理が起きるので、短い"共鳴調律（2〜3手）"を差し込んでもテンポを壊しにくい。効果は必ず探索HUDに反映させて、次の数部屋で効いているのが分かるようにします（事故率が下がる、継承枠の条件が進む、次の遭遇が良くなる等）。

#### 契約遭遇ノード（交渉イベント）として独立させるやり方

これはダンジョン内の偶然マッチングに相当し、入る前に"何が得意になりそうか"のシルエット（タグカテゴリや契約条項の種類）だけを見せます。中では会話風UIでやってもいいですが、実体は「条件提示→譲歩/強硬/保留」のような2〜3手の交渉で十分です。

**重要なのは、成立すると"次世代資産"になる見込みがその場で読めること**：Hadesが繰り返しの中で関係や報酬を積み上げるのが上手いと言われるのは、反復が意味を持つ見せ方ができているからで、ここだけ真似すれば良いです。

### 5.9.5 深層らしさの演出

深層に行くほど、UXは複雑にしない方がいいです。むしろ操作は同じなのに、判断の意味が変わる方が"深層感"が出ます。

たとえば浅層では「危険度：高＝戦闘がつらい」ですが、深層では「危険度：高＝持ち帰り資産が多い状態だと破滅的」になり、撤退判断の重みが変わる。Darkest Dungeonの批評が指摘する"どこまで押し込むか"の緊張は、こういう設計で出ます。

UIは同じでも、プレイヤーの読みが深くなるので、学習曲線が自然にできます。

## 5.10 設定

設定は、スワイプの好み（タグ優先）、演出（アニメーション量、低刺激モード）、通知（アプリ内のみ）、操作（キーバインド）を持たせます。低刺激モードは、モーションを減らし、スワイプの弾み演出を抑えます。

# 6. UIコンポーネント定義

プロトタイプはコンポーネントを揃えるほど検証が早くなります。必要なコンポーネントは、候補カード、タグチップ、相性バッジ、ボンドゲージ、配合スロット、結果カード、差分表示、確認ダイアログ、トースト通知です。これらの状態は、通常、ホバー、押下、無効、ローディング、エラーを持ちます。

相性は数値を出すかどうかが悩みどころですが、UI/UX検証では「数値なしの抽象（高い/普通/低い）」と「数値あり（例：73）」を切り替えられるトグルを仕込むと、どちらが理解されやすいかを比較できます。

# 7. 画面間遷移と主要フロー

## 7.1 全体ループ：相談所経営×ダンジョン周回×世代継承

### 7.1.1 相談所フェーズ（拠点）

1. **相談所の受付**: 相談所に入ると、受付の人が「どのようなご用件でしょうか？」と質問
   - プレイヤーは「候補を探す」「マッチを確認する」「配合を計画する」の3つから選択
2. **マッチング準備（候補を探すを選択した場合）**: 相談所の案件（候補リスト）から"当たり素材"を確保
   - 探す画面でスワイプ/選択
   - マッチ成立
   - マッチ後セッション（交渉→共鳴調律→盟約）で条件を満たす
3. **マッチ確認（マッチを確認するを選択した場合）**: 成立したマッチの一覧を確認し、ボンドを上げる
4. **配合計画（配合を計画するを選択した場合）**: 親個体を選択し、子の種族と継承をプレビューして配合を実行
5. **探索開始**: 準備が整ったら探索フェーズへ

### 7.1.2 探索フェーズ（ラン）

1. **分岐ノードマップでのルート選択**: Slay the Spireのような分岐ノードマップで、次のノードを選択
   - ノード種別：戦闘、イベント、休息、契約、精錬など
   - 各ノードで異なる意思決定を迫る
2. **部屋単位での進行**: ノードを選んで入った先は"部屋（ルーム）単位"でテンポよく進行
   - 部屋→報酬→次の扉という短いループ
   - 反復を苦痛にしにくい構造
3. **探索HUDでの常時情報表示**:
   - 生存資源（HPや回復回数など）
   - 継続リスク（ストレス/汚染/崩壊度）
   - 持ち帰り資産（"銀行に入った"分と"未精算で落とす"分）
4. **撤退判断**: 常に撤退可能で、持ち帰り資産とリスクを即座に判断できる
   - 撤退が単なる敗北ではなく"現実的な判断"になる
   - 得たものは一部持ち帰れるが、目的は未達になり、後始末コストが残る
5. **ダンジョン内マッチング（偶然遭遇）**: 希少素材との邂逅、救助、交渉、共鳴イベント
   - 休息ノードでの短い"共鳴調律（2〜3手）"
   - 契約遭遇ノード（交渉イベント）として独立
   - 市場では買えない"例外"の獲得（希少タグ、特殊条項、事故の救済、固定レシピのヒント、系譜コアの欠片など）
6. **選択の積み重ね**: 装備・消耗品・仲間の一時加入、リスク管理と撤退判断
7. **帰還/崩壊**: 撤退でも全滅でも終わる。収集物・情報・契約進捗が拠点へ持ち帰られる（全部は持ち帰れない）

### 7.1.3 継承フェーズ（世代更新）

1. **配合で系譜のコアを更新**: 次世代の核を作る
2. **固定化の枠を決める**: 何を永続資産として残すか（知識/制度/系譜コア）
3. **新世代で相談所へ戻る**: ループの再開

## 7.2 主要フロー（感情的な楽しさ）

相談所フェーズでの主要フローは、相談所の受付で「候補を探す」を選択し、探す画面で候補に出会い、いいねでマッチし、マッチ後セッション（交渉→共鳴調律→盟約）で条件を満たし、相談所に戻って「配合を計画する」を選択し、配合プランで結果を確認して配合実行する流れです。この流れでは：
- 相談所を「拠点」として認識し、受付の人の案内で各機能にアクセスする世界観の一貫性
- 格上個体とのマッチ成立による承認演出と実利の獲得
- マッチ後セッションの各段階でプランナーへの即座反映を確認
- 永続資産（知識/制度/系譜コア）の蓄積

## 7.3 別フロー（計画性の快適さ）

所持一覧から直接プランナーに入り、結果を見ながら素材を差し替え、最短で配合する流れも成立させます。この流れでは：
- 道中ボスの要求ビルドに合わせた素材選択
- 差分表示による比較検討
- 知識（法則・テーブルの解像度）を活用した計画的な配合

## 7.4 転生ループのフロー

魔王撃破または敗北により転生が発生した場合：
1. 自キャラクターと所持個体、編成はリセット（自キャラクターは未所持状態になる）
2. **永続資産は保持**:
   - **知識（法則・テーブルの解像度）**: 新しい配合レシピ、候補の確率、事故条件の情報
   - **制度（相談所・契約枠・推薦枠）**: 次ランの候補提示の質、希少遭遇率、固定枠の増加
   - **系譜コア（次世代の初期条件）**: 次世代の使役体の"核"（継承枠、スロット、初期タグ確定など）
3. 次周回での効果が適用される（盟約条項の選択肢増加、共鳴調律の初期値上昇など）
4. 系譜図鑑に記録された同系統の候補が出やすくなる

この二つの流れが両立しているかが重要で、前者は感情的な楽しさ、後者は計画性の快適さを担当します。

# 8. データ設計（UI用のモック）

UI検証なので、データはローカルで十分です。最低限必要なのは、自キャラクター（一体のみ）、個体（id、表示名、種族、位階、タグ、プロフィール文、ロック、所持スキル候補、遺伝子シード）、マッチ（相手id、成立日時、ボンド値、状態）、配合プラン（親A、親B、プレビュー結果、継承プレビュー、確率）です。配合結果の種族決定は簡易テーブルで構いませんが、プレビューと結果が一致することだけは守ります。ここがズレるとUX検証になりません。

## 8.0 自キャラクターのデータ構造

自キャラクターは一体のみ保有でき、複数所持の概念はありません。配合で新しい個体を獲得した場合、自キャラクターが置き換わります（転生ループでは、自キャラクターもリセットされます）。

- `playerCharacter`: オブジェクト（自キャラクター、nullの場合は未所持）
  - `id`: 文字列（個体ID）
  - `name`: 文字列（表示名）
  - `species`: 文字列（種族）
  - `tier`: 文字列（位階）
  - `tags`: 配列（タグ）
  - `skills`: 配列（所持スキル）
  - `level`: 数値（レベル、任意）
  - `hp`: 数値（HP、任意）
  - `maxHp`: 数値（最大HP、任意）
  - `status`: オブジェクト（現在の状態、任意）
  - `matchHistory`: 配列（マッチ履歴、任意）
    - 各レコード: `matchId`, `partnerId`, `establishedAt`

## 8.1 永続資産のデータ構造（3カテゴリ：継承の三層）

転生ループで周回をまたいで残る「永続資産」のデータ構造。ランで得た強さをそのまま次ランへ持ち越させない代わりに、次の3種類の資産だけは残します。これは2.1.4で定義した「継承の三層」と2.5で定義した「永続資産の3カテゴリ」に対応しています。継承は「能力値の積み上げ」より「選択肢の増加」と「納得できる決定論」に寄せます。

### 8.1.1 知識（情報の継承）

強さではなく"計画性"を上げる資産。『Hades』が言う"ローグでも結局持ち帰るのは知識"を正面からゲーム化します：

- `knowledge`: オブジェクト
  - `breedingRecipes`: 配列（新しい配合レシピ）
    - 各レコード: `parentASpecies`, `parentBSpecies`, `resultSpecies`, `probability`, `conditions`
  - `candidateProbabilities`: オブジェクト（候補の確率情報）
    - キー: 種族ID、値: 確率情報オブジェクト
  - `accidentConditions`: 配列（事故条件の情報）
    - 各レコード: `condition`, `description`, `avoidanceMethod`
  - `discoveredPatterns`: 配列（発見されたパターン）
    - 各レコード: `patternType`, `description`, `effect`
  - `enemyEncyclopedia`: 配列（敵図鑑：遭遇した敵の情報）
    - 各レコード: `enemyId`, `name`, `weaknesses`, `behaviorPattern`, `encounterConditions`
  - `encounterBranchConditions`: 配列（遭遇の分岐条件）
    - 各レコード: `eventId`, `conditions`, `description`
  - `consultationOfficeRumors`: 配列（相談所の噂）
    - 各レコード: `rumorType`, `description`, `effect`

### 8.1.2 選択肢（手段の継承）

相談所の契約条項の追加、ボンド行動（共同訓練・儀式・交渉）の解禁、ダンジョン内での遭遇プロトコル（奇襲せず交渉できる等）の解禁です。これが増えるほど、周回が"同じことの繰り返し"になりにくい：

- `choices`: オブジェクト
  - `institution`: オブジェクト（制度：メタ進行の施設強化）
    - `consultationOfficeRank`: 数値（相談所のランク）
    - `contractSlots`: 数値（契約枠の数）
    - `recommendationSlots`: 数値（推薦枠の数）
    - `candidateQualityBonus`: 数値（候補提示の質ボーナス、0.0〜1.0）
    - `rareEncounterRate`: 数値（希少遭遇率、0.0〜1.0）
    - `fixedSlotBonus`: 数値（固定枠の増加、0以上）
  - `availableCovenantClauses`: 配列（利用可能な契約条項）
    - 各レコード: `clauseId`, `name`, `description`, `effects`
  - `unlockedBondActions`: 配列（解禁されたボンド行動）
    - 各レコード: `actionId`, `name`, `description`, `unlockConditions`
  - `unlockedEncounterProtocols`: 配列（解禁された遭遇プロトコル）
    - 各レコード: `protocolId`, `name`, `description`, `unlockConditions`

### 8.1.3 系譜資産（配合の継承）

子の型は決定論、ただし継承枠・特性スロット・事故率・候補スキル幅がボンドや契約で揺れる、という分離方針です。これは『Into the Breach』のように"結果の納得感"を保ちやすい設計です。次世代の使役体の"核"だけ残すが、ただし「強さ」ではなく「選択肢の広さ」を残します：

- `lineageAssets`: オブジェクト
  - `inheritanceSlotExpectation`: 数値（継承枠の期待値、基本値 + ボーナス）
  - `skillSlots`: 数値（スキルスロットの数、基本値 + ボーナス）
  - `unlockedTraitSlots`: 配列（解放された特性スロット）
    - 各要素: `slotId`, `name`, `description`
  - `accidentRateImprovement`: 数値（事故率の改善、0.0〜1.0、値が大きいほど事故率が下がる）
  - `candidateSkillWidth`: 数値（候補スキル幅の拡大、基本値 + ボーナス）
  - `initialTags`: 配列（初期タグの確定）
    - 各要素: `tag`, `confirmed`: 真偽値
  - `lineageRecords`: 配列（過去に成立したマッチの組み合わせ）
    - 各レコード: `parentAId`, `parentBId`, `resultSpecies`, `establishedAt`, `tags`
  - `lineageBonuses`: オブジェクト（系譜による出現率ボーナス）
    - キー: 種族ID、値: 出現率ボーナス（例: 0.1 = +10%）

## 8.2 パラメータの4層構造のデータ構造

### 8.2.1 第一層：公開情報
- `publicInfo`: オブジェクト
  - `species`: 文字列（種族）
  - `tier`: 文字列（位階）
  - `role`: 文字列（ロール）
  - `mainTags`: 配列（主要タグ2〜3個）
  - `fatalRejections`: 配列（致命的な拒否条件）

### 8.2.2 第二層：準公開情報（推定表示）
- `estimatedInfo`: オブジェクト
  - `resistances`: 配列（耐性の推定値）
    - 各要素: `type`（"ice", "fire"など）、`value`（"likely", "possible", "unlikely"）、`confirmed`: 真偽値
  - `weaknesses`: 配列（弱点の推定値、同じ構造）
  - `inheritanceAptitude`: オブジェクト（継承の得意分野）
    - `support`: 文字列（"high", "medium", "low"）、`confirmed`: 真偽値
    - `attack`: 文字列（同上）
  - `passiveTendency`: 文字列（"healing", "buffing"など）、`confirmed`: 真偽値

### 8.2.3 第三層：深掘り情報
- `deepInfo`: オブジェクト
  - `hiddenTags`: 配列（隠しタグ、相性が極端に良い/悪いタグ）
  - `accidentAffectingTraits`: 配列（事故率に影響する気質）
  - `highRareSkillCandidates`: 配列（継承候補スキルの上位枠）
  - `specialBreedingHints`: 配列（特殊配合のヒント）
  - `trueNameFragments`: 配列（真名の断片）

### 8.2.4 第四層：サプライズ情報
- `surpriseInfo`: オブジェクト
  - `covenantBonus`: 数値（盟約条項の追加数、0または1）
  - `inheritanceSlotBonus`: 数値（継承枠の一時的増加、0または1）
  - `accidentTableImprovement`: 真偽値（事故テーブルが良化したか）
  - `specialInheritancePattern`: 文字列（特殊な継承パターンの解放）

## 8.3 マッチ後セッション（ミニゲーム）のデータ構造

### セッション全体
- `matchSession`: オブジェクト
  - `matchId`: 文字列（マッチID）
  - `currentFavorability`: 数値（現在の好感度）
  - `sessionState`: 文字列（"not_started", "in_progress", "completed", "on_hold"）
  - `completedGames`: 配列（完了したミニゲームの記録）
  - `revealedParameters`: オブジェクト（開示されたパラメータ）
    - `layer2`: 配列（第二層で確定した情報）
    - `layer3`: 配列（第三層で開示された情報）
    - `layer4`: 配列（第四層で開示された情報）

### ミニゲームの種類とデータ構造

### 8.3.1 契約交渉（会話カード）型
- `negotiationGame`: オブジェクト
  - `gameType`: "negotiation"
  - `selectedCard`: 文字列（"condition", "benefit", "concession", "question"）
  - `favorabilityChange`: 数値（好感度の変化）
  - `revealedInfo`: 配列（開示された情報）
    - 各要素: `type`（"resistance", "weakness", "tag"など）、`value`: 文字列、`layer`: 数値（2, 3, 4）

### 8.3.2 共鳴調律（パズル）型
- `resonanceTuningGame`: オブジェクト
  - `gameType`: "resonance_tuning"
  - `successLevel`: 文字列（"perfect", "good", "normal", "failure"）
  - `favorabilityChange`: 数値（好感度の変化）
  - `revealedInfo`: 配列（開示された情報、同じ構造）

### 8.3.3 儀式手順（記憶・順序）型
- `ritualSequenceGame`: オブジェクト
  - `gameType`: "ritual_sequence"
  - `success`: 真偽値（成功したか）
  - `favorabilityChange`: 数値（好感度の変化）
  - `trueNameFragment`: 文字列（獲得した真名の断片、成功時のみ）
  - `hintForNext`: 文字列（次回のヒント、失敗時のみ）
  - `revealedInfo`: 配列（開示された情報、同じ構造）

### 8.3.4 贈与/供物の調合（選択）型
- `offeringGame`: オブジェクト
  - `gameType`: "offering"
  - `selectedOfferings`: 配列（選択した供物のID、2つ）
  - `preferenceMatch`: 真偽値（嗜好に合致したか）
  - `favorabilityChange`: 数値（好感度の変化）
  - `revealedInfo`: 配列（開示された情報、特に嗜好タグ）

### 8.3.5 同行試練（短い判断）型
- `trialGame`: オブジェクト
  - `gameType`: "trial"
  - `situation`: 文字列（状況説明）
  - `selectedJudgment`: 文字列（選択した判断）
  - `valueMatch`: 真偽値（価値観に合致したか）
  - `favorabilityChange`: 数値（好感度の変化）
  - `revealedInfo`: 配列（開示された情報、特に価値観タグ、気質）

### 盟約（コミット）のデータ構造
- `covenantState`: オブジェクト
  - `availableClauses`: 配列（利用可能な条項、好感度に応じて2〜4個）
  - `selectedClause`: オブジェクト（選択した条項、nullの場合は未選択）
    - `id`: 文字列
    - `name`: 文字列
    - `tradeoff`: オブジェクト（トレードオフの内容）
      - `benefit`: 文字列（メリット）
      - `cost`: 文字列（デメリット）
    - `effects`: オブジェクト（プランナーへの影響）
      - `inheritanceSlots`: 数値（継承枠の変化、例: +1）
      - `accidentRate`: 数値（事故率の変化、例: +0.05）
      - `candidateProbabilities`: オブジェクト（候補確率の変化）

### 好感度が下がり過ぎた場合
- `sessionOnHold`: オブジェクト
  - `isOnHold`: 真偽値（契約保留中か）
  - `holdUntil`: 日時（再交渉可能になる日時）
  - `renegotiationCost`: 数値（再交渉に必要な好感度の閾値増加）

## 8.4 道中ボスのデータ構造

- `currentBoss`: オブジェクト（現在のボス）
  - `id`: 文字列
  - `name`: 文字列
  - `threatProfile`: 配列（脅威プロファイル、例: ["状態異常", "単体高火力"]）
  - `recommendedTags`: 配列（推奨タグ）
  - `recommendedResistances`: 配列（推奨耐性）
  - `recommendedRoles`: 配列（推奨ロール）
- `nextBoss`: オブジェクト（次のボス、同じ構造）

# 9. エラーと例外の設計

いいね枯渇、所持枠満杯、ロック個体の誤投入、ネットワーク不安定（疑似）、配合不可条件（同一個体、禁止組み合わせ）を想定し、すべて「何が起きたか」「どうすればよいか」を一文で出します。エラー文は専門用語を避け、「所持枠がいっぱいです。不要な個体を整理するか、ロックを見直してください」のように行動を添えます。

# 10. アクセシビリティと操作性

キーボードだけで「探す」「いいね/スキップ」「詳細」「プランナーで素材選択」「配合実行」まで到達できることを要件にします。モーションは低刺激モードで抑制し、重要情報は色だけで表現しません。タグはテキストで、差分も記号と文で表現します。

# 11. 検証項目（UXテスト観点）

## 11.1 基本UX検証項目

検証では、ユーザーが「探す」画面で何を根拠にいいねするか、プランナーで結果プレビューを理解できるか、ボンドの効果を説明なしで理解できるか、誤操作（ロック、枯渇、戻る）時にストレスが小さいかを見ます。プロトタイプには、操作ログ（画面滞在時間、スワイプ回数、詳細閲覧率、プランナー差分利用率、キャンセル率）を取れるようにして、主観評価と合わせて判断できるようにします。

## 11.2 ゲーム性の検証項目

### マッチ後セッション
- ユーザーが「交渉→共鳴調律→盟約」の各段階で、何を根拠に選択するか
- 各段階でのフィードバック（改善内容の表示）が理解できるか
- プランナーへの即座反映（差分表示）が分かりやすいか
- セッション全体が"作業"ではなく"プランニングの一部"と感じられるか

### 格上からの承認
- 格上個体とのマッチ成立時の演出が「特別感」を感じさせるか
- 実利の付与（盟約条項増加、継承枠+1など）が「ちゃんと得をした」感を出せるか
- 天井（ピティ）の表示が「次への期待」を感じさせるか

### 縁の資産
- 失敗周回でも「自分は確実に上がっている」感が出るか
- 系譜図鑑の効果（同系統の候補が出やすくなる）が実感できるか
- 次周回での効果（盟約条項の選択肢増加など）が分かりやすいか

### 道中ボスとの連携
- ボスの要求ビルドが分かりやすいか
- プランナーでの「推奨タグ」「推奨耐性」の提示が行動に影響するか
- ビルド作成→オート戦闘→検証の循環が気持ちよく回るか

### 転生ループ
- 転生が「罰」ではなく「次の周回の燃料」と感じられるか
- 縁の資産の保持が「確実に上がっている」感を出せるか
- 次周回での効果が実感できるか

# 12. 受け入れ基準（プロトタイプ完成条件）

## 12.1 基本機能の完成条件

プロトタイプ完成の最低条件は、スマホとPCでスワイプが成立し、マッチが生成され、マッチ後セッション（交渉→共鳴調律→盟約）が実行でき、配合プランナーで結果プレビューが表示され、実行すると結果画面に遷移することです。さらに、いいね枯渇とロック誤投入が、ユーザーの迷いなく回避できる文言と導線になっていることを確認します。

## 12.2 ゲーム性の完成条件

### マッチ後セッション
- 交渉、共鳴調律、盟約の各段階が実行できる
- 各段階でのフィードバック（改善内容の表示）が表示される
- プランナーへの即座反映（差分表示）が機能する
- セッション完了時に最終的な効果が表示される

### 格上からの承認
- 格上個体とのマッチ成立時に特別な演出が表示される
- 実利の付与（盟約条項増加、継承枠+1など）が機能する
- 天井（ピティ）の表示が機能する

### 縁の資産
- 名声、系譜図鑑、契約の実績が周回をまたいで保持される
- 次周回での効果（盟約条項の選択肢増加など）が適用される
- 系譜図鑑の効果（同系統の候補が出やすくなる）が機能する

### 道中ボスとの連携
- ボスの要求ビルドが表示される
- プランナーでの「推奨タグ」「推奨耐性」の提示が機能する

### 転生ループ
- 転生時に縁の資産が保持される
- 次周回での効果が適用される

# 13. 実装状況と設計書との差異

本セクションは、実装コードと設計書を比較し、実装状況と差異を記録します。設計や企画の再検討の参考として使用してください。

## 13.1 実装済みの主要機能

### 13.1.1 技術スタック
- ✅ **Flutter 3.x** + **Dart** - UIフレームワーク
- ✅ **Riverpod** - 状態管理
- ✅ **go_router** - ルーティング
- ✅ **Material Design 3** - UIデザインシステム

### 13.1.2 基本画面構成
- ✅ ホーム画面（ダッシュボード）
- ❌ **相談所画面（受付）**: 未実装。受付の人が3つの機能（探す、マッチ、配合）への案内を行う画面が必要
- ✅ 探す画面（ディスカバー/スワイプ）
  - ✅ オススメタブ（スワイプ機能）
  - ✅ 探すタブ（モンスター一覧）
- ✅ マッチ一覧
- ✅ 配合プランナー
- ✅ 配合結果
- ✅ 所持一覧（コレクション）
- ✅ 設定

### 13.1.3 ナビゲーション
- ✅ スマホ用下部タブ（bottom_navigation.dart）
- ⚠️ **タブ構成**: 現在は「探す、マッチ、配合、所持」だが、設計では「相談所、所持」に変更が必要
  - 設計変更: 「探す」「マッチ」「配合」は相談所内の機能として統合され、下部タブから直接アクセスしない

### 13.1.4 基本機能
- ✅ スワイプ操作（スマホ/PC対応、GestureDetector使用）
- ✅ キーボード操作（探す画面：←/A = スキップ, →/D = いいね, Enter = 詳細）
- ✅ いいね/スキップ/ブックマーク
- ✅ マッチ生成
- ✅ ボンド値の管理（ボタンで+10する機能）
- ✅ 配合プレビュー（子の種族、位階、タグ、継承枠、候補スキル、事故率）
- ✅ 配合実行
- ✅ ロック機能
- ✅ 検索・フィルタ（種族、位階）
- ✅ 候補詳細モーダル（MonsterDetailDialog）
- ✅ 相性表示（Compatibility表示）
- ✅ 目標設定（目標種族、目標タグ）
- ✅ ブックマーク機能（storeに実装済み）

## 13.2 未実装の機能（設計書との差異）

### 5.1 ホーム（ダッシュボード）
- ❌ **情報設計の4層構造**: 「状況 → 次の一手 → 証跡 → 詳細」の情報設計が未実装。現在は全ての情報が同じレイヤーで並んでいる
- ❌ **世界の状況（要約）**: ダンジョンの踏破状況から判断した総合状態のラベル（「封印は安定」など）と「次の遠征で何をすべきか」の一文表示が未実装（数値的なメトリクスではなく、物語的な表現で）
- ❌ **用語の翻訳**: 現実アプリ語彙（「いいね残量」など）を世界内用語（「本日の調停回数」など）に翻訳する機能が未実装
- ❌ **主導線（主CTA）**: 状態に応じてラベルと遷移先を変える1つの主ボタンが未実装（現在は「相談所へ」のみ）
- ❌ **次のマイルストーン表示**: 合計値ではなく「次のマイルストーンまで」の表示が未実装（例：「次の相談所ランクまであと2件」）
- ❌ **出来事のログ**: 直近のマッチ・交配を「カード一覧」ではなく「出来事のログ」として表示する機能が未実装（1行で成果と意味を表示）
- ❌ **詳細の折りたたみ**: 数字の詳細を折りたたみで配置し、必要に応じて展開できる機能が未実装
- ❌ **自キャラクターの表示**: 画面上部に自キャラクターを大きく表示する機能が未実装（種族、位階、主要タグ、現在の状態を表示）
- ❌ **自キャラクターの詳細**: 自キャラクターカードをタップすると詳細情報（スキル、ステータス、マッチ履歴など）を表示する機能が未実装
- ❌ **初回ツアー**: 「探す」「配合」の2ステップのツアーが未実装
- ❌ **永続資産の表示**: 転生ループで周回をまたいで残る「永続資産（知識/制度/系譜コア）」の表示が未実装（詳細は折りたたみで表示）
- ❌ **進行状況と次のボス**: 現在の進行状況（何周回目か、次のボスは何か）の表示が未実装（詳細は折りたたみで表示）
- ❌ **UIデザインの統一**: カードの色とアイコンをMaterial 3の統一トーンに寄せる機能が未実装（現在は強い色分け）
- ❌ **設計意図の説明の退避**: カード内の設計意図の説明を「i」ボタンや「ヘルプ」モーダルに退避する機能が未実装
- ❌ **開発者表示トグル**: 設定に「開発者表示（数値と設計注釈）」トグルを作る機能が未実装

### 5.2 探す（ディスカバー／スワイプ）
- ✅ **オススメタブと探すタブ**: 設計にはないが、実装では2つのタブに分かれている（オススメ=スワイプ、探す=一覧）
- ⚠️ **目標への貢献度**: 実装されているが、設計では「目標タグへの貢献度」を想定しているのに対し、実装では`inventory[0]`との相性を表示している
- ❌ **道中ボス連携**: 「この候補が次のボス攻略にどう効くか」の表示が未実装
- ❌ **格上からの承認演出**: 格上個体とのマッチ成立時の特別な演出、実利の付与、天井（ピティ）の表示が未実装
- ❌ **上スワイプでブックマーク**: 設計では上スワイプでブックマークを想定しているが、実装ではボタン操作のみ

### 5.3 候補詳細（プロフィールモーダル）
- ❌ **注意点（継承不可など）**: 「注意点（継承不可など）」の表示が未実装
- ❌ **通報機能**: 「通報（冗談機能でも良いがUIの逃げ道として）」が未実装

### 5.4 マッチ一覧
- ❌ **未読バッジ**: 「未読の新規マッチがあるときはタブにバッジを出し」が未実装
- ❌ **ボンドセッションへの遷移**: 「ボンドを上げるミニセッションに遷移でき」とあるが、実装ではボタンで+10するだけ（詳細は5.5参照）

### 5.5 マッチ後セッション（ミニゲームによる好感度とパラメータ開示）
- ❌ **完全未実装**: 設計では5種類のミニゲーム（契約交渉、共鳴調律、儀式手順、贈与/供物の調合、同行試練）によるセッションを想定しているが、実装ではマッチ一覧でボタンを押すと+10されるだけ
- ❌ **パラメータの4層構造**: 第一層（公開情報）、第二層（準公開情報）、第三層（深掘り情報）、第四層（サプライズ情報）の段階的開示が未実装
- ❌ **好感度システム**: 好感度の積み上げ、好感度に応じたパラメータ開示、好感度が下がり過ぎた場合の処理（契約保留、再交渉コスト増加）が未実装
- ❌ **契約交渉（会話カード）型**: 選択肢カードによる交渉、好感度の変動、パラメータの開示が未実装
- ❌ **共鳴調律（パズル）型**: 波形/ルーン列の調整、成功度に応じた好感度とパラメータ開示が未実装
- ❌ **儀式手順（記憶・順序）型**: 儀式の手順記憶、真名の断片の獲得が未実装
- ❌ **贈与/供物の調合（選択）型**: 供物の選択、嗜好タグの確定が未実装
- ❌ **同行試練（短い判断）型**: 状況判断の選択、価値観タグの確定が未実装
- ❌ **盟約（コミット）**: トレードオフ付きの条項選択と、プランナーへの反映が未実装
- ❌ **フィルタとの連携**: 「不明を含める（要確認）」スイッチ、未確定情報の表示が未実装
- ❌ **効果のフィードバック**: 「好感度が増えて、増えた分の効果（例：継承枠+1の可能性が上がった）を一行でフィードバック」が未実装
- ⚠️ **実装方針の差異**: 設計では「配合を良くするための前作業を気持ちよくする画面」として独立したミニゲームセッションを想定しているが、実装では簡易的なボタン操作のみ

### 5.6 配合プランナー
- ❌ **差分表示**: 「直前のプランと差分表示」が未実装
  - 設計: 「同じ親Bで親Aだけ差し替えたときに、子の種族と継承がどう変わるかを見たいので、『直前のプランと差分表示』を用意します。差分は色ではなく、プラスマイナス記号と短文で表現します。」
- ❌ **未達条件の表示**: 「現在のプランで『まだ満たしていない条件』を明示」が未実装
- ❌ **条件達成による変化**: 「マッチ後セッションで条件が達成されると、プランナーのプレビューがリアルタイムで更新される」が未実装
- ❌ **道中ボスとの連携**: 「現在の進行状況」と「次のボス」の表示、「推奨タグ」「推奨耐性」「推奨ロール」の提示が未実装
- ❌ **複数候補の表示**: 「もし候補が複数になる設計なら、最大3体までを横並びで出し、それぞれに確率と"確定させる条件（ボンドやタグ）"を添えます」とあるが、現在は1体のみ表示
- ⚠️ **親選択方法**: 設計では「所持一覧やマッチ一覧からドラッグまたは選択で入れます」とあるが、実装ではselect要素による選択のみ（ドラッグ機能は未実装）
- ⚠️ **確認ダイアログの詳細**: 設計では「詳細は『内訳を見る』で折りたたみにします」とあるが、実装では常に表示

### 5.7 配合結果
- ✅ **「この子を目標に設定」機能**: 実装済み（breeding_result_screen.dart 232-245行目で目標を設定し、設定画面に遷移）
- ❌ **自キャラクターの置き換え**: 配合で新しい個体を獲得した場合、自キャラクターが置き換わる機能が未実装（「新しい自キャラクターになりました」という表示も未実装）

### 5.8 所持一覧（コレクション）
- ❌ **タグフィルタ**: 「フィルタは、種族、位階、タグ、ボンド状態（マッチ中、候補中）、ロック状態（保護）を想定します」とあるが、実装では種族と位階のみ
- ❌ **ボンド状態フィルタ**: マッチ中/候補中のフィルタが未実装
- ❌ **ロック状態フィルタ**: ロック状態でのフィルタが未実装


### 5.10 設定
- ❌ **スワイプの好み設定**: 「スワイプの好み（タグ優先）」が未実装
- ❌ **演出設定**: 「演出（アニメーション量、低刺激モード）」が未実装
- ❌ **通知設定**: 「通知（アプリ内のみ）」が未実装
- ❌ **操作設定**: 「操作（キーバインド）」が未実装
- ⚠️ **目標設定**: 実装されているが、設計では「目標種族」「目標タグ」のみで、「次に推奨する行動」の設定は含まれていない

### 6. UIコンポーネント定義
- ❌ **相性バッジ**: 「相性バッジ」コンポーネントが未実装（実装では相性はテキスト表示のみ）
- ❌ **配合スロット**: 「配合スロット」コンポーネントが未実装（実装ではselect要素を使用）
- ❌ **差分表示コンポーネント**: 「差分表示」コンポーネントが未実装
- ❌ **トースト通知**: 「トースト通知」が未実装（現在はalertを使用）

### 8. データ設計（UI用のモック）
- ✅ **データ管理**: Riverpod（StateNotifier）でメモリ内管理
- ✅ **モックデータ**: mock_data.dartで提供
- ❌ **自キャラクターのデータ構造**: 自キャラクター（一体のみ）のデータ構造が未実装（playerCharacterオブジェクト）
- ❌ **縁の資産のデータ構造**: 名声、系譜図鑑、契約の実績のデータ構造が未実装
- ❌ **マッチ後セッションのデータ構造**: 交渉、共鳴調律、盟約のデータ構造が未実装
- ❌ **道中ボスのデータ構造**: ボスの脅威プロファイル、推奨タグ・耐性・ロールのデータ構造が未実装
- ⚠️ **ブックマークのUI**: ブックマーク機能はstoreに実装されているが、UI上での表示・管理画面が未実装
  - 設計では「候補の『最近見た』『あとで見る』も用意します」とあるが、「あとで見る」の一覧画面が未実装

### 9. エラーと例外の設計
- ❌ **所持枠満杯のエラー**: 「所持枠満杯」のエラーハンドリングが未実装
- ❌ **ネットワーク不安定（疑似）**: 「ネットワーク不安定（疑似）」のエラーが未実装
- ❌ **配合不可条件のエラー**: 「配合不可条件（同一個体、禁止組み合わせ）」のエラーハンドリングが未実装
  - 現在はロック個体の誤投入のみアラートで対応

### 10. アクセシビリティと操作性
- ❌ **低刺激モード**: 「モーションは低刺激モードで抑制し」とあるが、未実装
- ⚠️ **キーボード操作**: 探す画面では実装されているが、他の画面（配合プランナー、所持一覧など）でのキーボード操作は未実装

### 11. 検証項目（UXテスト観点）
- ❌ **操作ログ**: 「操作ログ（画面滞在時間、スワイプ回数、詳細閲覧率、プランナー差分利用率、キャンセル率）を取れるようにして」が完全に未実装

## 13.3 実装方針の差異

### 技術スタック
- **実装**: Flutter 3.x + Dart + Riverpod + go_router + Material Design 3

### 配合プランナーの親選択方法
- **設計**: 「所持一覧やマッチ一覧からドラッグまたは選択で入れます」
- **実装**: DropdownButtonによる選択のみ（ドラッグ機能は未実装、breeding_screen.dart 453-467行目）

### ボンドの上げ方
- **設計**: 「ボンドを上げるミニセッションに遷移でき」→「選択肢会話」「短いゲージ上げ」「2回タップで完了」
- **実装**: マッチ一覧画面でボタンを押すと+10されるだけ（matches_screen.dart 107-119行目）

### 目標への貢献度の計算方法
- **設計**: 「あなたの目標への貢献度」→目標タグとの比較を想定
- **実装**: `inventory[0]`との相性を表示（目標タグとの直接比較ではない、discover_screen.dart 172-178行目）

### 探す画面の構成
- **設計**: 単一のスワイプ画面
- **実装**: 2つのタブに分割（オススメ=スワイプ、探す=一覧表示、discover_screen.dart 124-130行目）

### ナビゲーション
- **設計**: 「スマホは下部タブ、PCは左サイドバーを基本にします」
- **実装**: 下部タブのみ実装（PCでも下部タブを使用）

## 13.4 優先度の高い未実装機能（UX検証に重要）

### 最優先（ゲーム性の核心）
1. **マッチ後セッション（5.5）**: 設計の核心機能の一つ。「交渉→共鳴調律→盟約」の3段階セッションを実装。現在はボタンで+10するだけでは「配合を良くするための前作業を気持ちよくする」という目的を達成できない
2. **差分表示（5.6）**: 配合プランナーでの「比較」機能は計画性の快適さに直結する。また、マッチ後セッションの各段階でのプランナーへの即座反映も重要
3. **縁の資産の実装（14.2）**: 転生ループの核心。名声、系譜図鑑、契約の実績のデータ構造とUI表示を実装
4. **格上からの承認演出（5.2.2, 14.3.2）**: ゲーム性の中毒性に直結。格上個体とのマッチ成立時の特別な演出と実利の付与を実装

### 高優先度
5. **道中ボスとの連携（5.6.3, 14.5）**: マッチングと配合が"攻略の前提"であることを明確にする。ボスの要求ビルドの表示と、プランナーでの推奨タグ・耐性・ロールの提示を実装
6. **未達条件と条件達成による変化（5.6.1）**: マッチ後セッションの各段階でプランナーへの即座反映を可視化
8. **初回ツアー（5.1）**: ユーザーの初回体験に影響

### 中優先度
9. **複数候補の表示（5.6）**: 設計では「もし候補が複数になる設計なら」と条件付きだが、実装されていない
10. **所持枠満杯のエラー（9）**: エラーハンドリングはUX検証に重要
11. **設定画面の拡張（5.10）**: 特に低刺激モードはアクセシビリティに重要
12. **ブックマーク一覧画面（8）**: 「あとで見る」機能の完成
13. **操作ログ（11）**: UX検証のためのデータ収集

## 13.5 実装の品質に関する所見

### 良い点
- 基本的な画面遷移とナビゲーションは設計通りに実装されている
- スワイプ操作とキーボード操作が実装されている
- 型定義がしっかりしている（Dartの型システムを活用）
- 状態管理（Riverpod）が適切に使用されている
- FlutterのMaterial Design 3を活用した統一感のあるUI
- レスポンシブデザインが実装されている（画面幅に応じたグリッド列数の調整）
- モーダルダイアログ（MonsterDetailDialog）が適切に実装されている

### 改善の余地
- エラーハンドリングが不足している（所持枠満杯、配合不可条件など）
- 一部の機能が設計の意図と異なる実装になっている（目標への貢献度、ボンドの上げ方）
- UX検証に必要な機能（操作ログ、再現機能）が未実装
- ボンドセッションが簡易的なボタン操作のみで、設計の意図（ミニゲーム的な体験）が実現されていない

## 13.6 次のステップへの推奨事項

### フェーズ1: ゲーム性の核心実装（最優先）
1. **マッチ後セッションの実装**: 設計の核心機能なので最優先で実装
   - パラメータの4層構造の実装: 第一層（公開情報）、第二層（準公開情報）、第三層（深掘り情報）、第四層（サプライズ情報）の段階的開示
   - 好感度システムの実装: 好感度の積み上げ、好感度に応じたパラメータ開示、好感度が下がり過ぎた場合の処理
   - 5種類のミニゲームの実装:
     - 契約交渉（会話カード）型: 選択肢カードによる交渉
     - 共鳴調律（パズル）型: 波形/ルーン列の調整
     - 儀式手順（記憶・順序）型: 儀式の手順記憶
     - 贈与/供物の調合（選択）型: 供物の選択
     - 同行試練（短い判断）型: 状況判断の選択
   - 盟約（コミット）: トレードオフ付きの条項選択と、プランナーへの反映
   - フィルタとの連携: 「不明を含める（要確認）」スイッチ、未確定情報の表示
2. **縁の資産の実装**: 転生ループの核心
   - 名声（市場価値）のデータ構造とUI表示
   - 系譜図鑑のデータ構造と効果の実装
   - 契約の実績のデータ構造と次周回での効果の実装
3. **格上からの承認演出**: ゲーム性の中毒性に直結
   - 格上個体とのマッチ成立時の特別な演出
   - 実利の付与（盟約条項増加、継承枠+1など）
   - 天井（ピティ）の表示

### フェーズ2: プランナーの強化
4. **差分表示の実装**: 配合プランナーの価値を高める（直前のプランと差分表示、マッチ後セッションの各段階での即座反映）
5. **未達条件と条件達成による変化**: マッチ後セッションの各段階でプランナーへの即座反映を可視化
6. **道中ボスとの連携**: ボスの要求ビルドの表示と、プランナーでの推奨タグ・耐性・ロールの提示

### フェーズ3: UX検証の強化
8. **エラーハンドリングの強化**: ユーザーの迷いを減らす（所持枠満杯、配合不可条件など）
9. **操作ログの実装**: UX検証のためのデータ収集（画面滞在時間、スワイプ回数、詳細閲覧率など）
10. **初回ツアー**: ユーザーの初回体験に影響

### フェーズ4: 機能の完成
11. **ブックマーク一覧画面の実装**: 「あとで見る」機能の完成
12. **設定画面の拡張**: スワイプの好み、演出設定、低刺激モード、キーバインド設定
13. **複数候補の表示**: 設計では条件付きだが、実装されていない

――――

ここまでがUI/UX検証用の設計書です。実装の都合で画面数を削るなら、「探す」「配合プランナー」「配合結果」の3画面は残し、「マッチ一覧」と「ボンド」はプランナー内モーダルに統合するのが最も崩れにくい落とし方です。これで"マッチングの気分"と"配合の法則性"を、UIだけで検証できます。

# 14. ゲーム性の詳細設計

本セクションは、マッチングアプリ的な中毒性の核をゲーム文脈（共鳴・契約・儀式・転生ループ）に翻訳した、具体的なゲーム性設計です。UI/UX中心で回せる行動ループ、進行ゲート、報酬設計、失敗の学習化を定義します。

## 14.1 ゲーム性の核：ローグライク周回と世代継承の中心

### 14.1.1 基本構造

ゲームの面白さは「戦闘で勝つ」より「勝てるように"縁"と"系譜"を設計する」側に寄せます。戦闘が自動で、敵がだんだん強くなり、魔王を倒すまで転生で最初に戻されるなら、プレイヤーの主たる意思決定は戦闘中ではなく戦闘前の"編成・育成・配合・素材調達"に集約されます。

**重要な設計方針**: 配合とマッチングは「ランを良くする準備」ではなく、**ランの成果を"次のランが面白くなる形に変換する工程"**として位置づけます。これにより、配合は"強化手段"ではなく、**ローグライク周回の生存戦略と、世代継承の経営判断**になります。

### 14.1.2 面白さの3層構造

面白さを混ぜると破綻するため、役割分担します：

- **層1：ラン（ローグライク）での面白さ**: 毎回違う状況での即興ビルド、リスク管理と撤退判断、選択の積み重ねが結果に直結する納得感
- **層2：メタ（世代継承）での面白さ**: 次世代に残す資産の選択（固定化）、法則解禁・施設強化・図鑑の拡張で次ランが"少し"楽になる、失敗しても意味が残る
- **層3：ドラマ（マッチング）での面白さ**: 相手（素材）を見つけ、関係を調整し、成立させる過程の快感、"交渉・共鳴・契約"としての試行錯誤、たまに起こる大進展（レア成立・事故・特殊条件）

**重要**: マッチングは層3、配合は層2寄りに置き、層1（ラン）の中心にしすぎないことです。ランの最中に配合を中心にするとテンポが死にます。

### 14.1.3 転生ループの設計

転生を「罰」ではなく「次の周回の燃料」にするため、周回ごとにマッチング体験が少しずつアップグレードされる必要があります。周回で失うのは所持個体や当面の編成で、周回をまたいで残るのは「永続資産（知識/制度/系譜コア）」です。

## 14.2 永続資産の詳細（3カテゴリ：継承の三層）

ランで得た強さをそのまま次ランへ持ち越させない代わりに、次の3種類の資産だけは残します。これは2.1.4で定義した「継承の三層」と2.5で定義した「永続資産の3カテゴリ」に対応しています。継承は「能力値の積み上げ」より「選択肢の増加」と「納得できる決定論」に寄せます。

### 14.2.1 知識（情報の継承）

- **定義**: 強さではなく"計画性"を上げる資産。『Hades』が言う"ローグでも結局持ち帰るのは知識"を正面からゲーム化します
- **獲得方法**: 配合実行、マッチ後セッションでの情報開示、ダンジョン探索での発見
- **効果**: 
  - 新しい配合レシピが見える
  - 候補の確率が見える
  - 事故条件が分かる
  - 敵図鑑：遭遇した敵の情報、弱点、行動パターン
  - 遭遇の分岐条件：特定のイベントが発生する条件
  - 相談所の噂：候補の出やすさ、希少遭遇のヒント
  - 計画的な配合が可能になる
- **表示**: ホーム画面、配合プランナー（情報として表示）、相談所（知識の一覧）

### 14.2.2 選択肢（手段の継承）

- **定義**: 相談所の契約条項の追加、ボンド行動（共同訓練・儀式・交渉）の解禁、ダンジョン内での遭遇プロトコル（奇襲せず交渉できる等）の解禁です。これが増えるほど、周回が"同じことの繰り返し"になりにくい
- **獲得方法**: マッチ成立、配合成功、相談所ランクアップ、契約実績の蓄積、ボンド行動の成功
- **効果**: 
  - 相談所の契約条項の追加：次周回で選択できる契約条項が増える（制度の強化）
  - 契約枠・推薦枠の増加：次ランの候補提示が良くなる、希少遭遇が増える、固定枠が少し増える
  - ボンド行動の解禁：新しいミニゲームや交渉手段が使えるようになる
  - 遭遇プロトコルの解禁：ダンジョン内での新しい遭遇方法が使えるようになる
  - 相談所の格付けが上がる
- **表示**: ホーム画面、相談所画面（ランク、契約枠、推薦枠の表示）、マッチ後セッション（新しい行動の選択肢）

### 14.2.3 系譜資産（配合の継承）

- **定義**: 子の型は決定論、ただし継承枠・特性スロット・事故率・候補スキル幅がボンドや契約で揺れる、という分離方針です。これは『Into the Breach』のように"結果の納得感"を保ちやすい設計です。次世代の使役体の"核"だけ残すが、ただし「強さ」ではなく「選択肢の広さ」を残します
- **獲得方法**: 配合で"系譜のコア"を更新、継承フェーズで固定化の枠を決める
- **効果**: 
  - 継承枠の期待値：次世代に継承できる枠の平均値が上がる
  - 特性スロットの解放：新しい特性スロットが使えるようになる
  - 事故率の改善：配合時の事故率が下がる、または事故の内容が軽くなる
  - 候補スキル幅の拡大：継承できるスキルの種類が増える
  - 初期タグの確定：次世代の初期タグが確定する
  - 次世代の選択肢が広がる
- **表示**: ホーム画面、配合プランナー（系譜コアの表示）、継承フェーズ（固定化の選択）

### 14.2.4 永続資産のバランス設計

「強くなること」と「条件を揃えること」が逆行しないようにするため、以下の対策を取ります：

- **条件を"硬い必須"にせず、「達成すると報酬が増える」に寄せる**
  - 例：火氷耐性があると深層の報酬部屋に入れる、事故を回避できる、封印の再起動効率が上がる
  - つまり"必要だから積む"ではなく"積むと得"にする

- **条件を耐性や数値ではなく、行動で満たせるようにする**
  - 例：「浄化が必要」ではなく「浄化の儀式を1回成功させると、状態異常の事故テーブルが改善する」
  - これなら純粋な強さと競合しにくい

## 14.3 格付け市場と承認演出

### 14.3.1 格付けの仕組み

- **個体の格**: 位階、稀少性、タグの強さで決定
- **プレイヤーの市場価値**: 名声値で表現
- **到達難易度**: プレイヤーの名声と個体の格の差で計算

### 14.3.2 格上からの承認

「現実では歯牙にもかからない異性に相手にされる快感」は、ゲームでは「格上からの承認」で再現します。具体的には：
- **格上枠の仕組み**: 時々だけ「今の名声では普通は成立しない格上」が流れてくる枠を作る
- **成立演出**: 通常のマッチ成立より派手な演出（エフェクト、音、アニメーション）
- **実利の付与**: 
  - 盟約条項が1枚多い
  - 継承枠の上限が一時的に+1
  - 事故テーブルが良化
- **天井（ピティ）の仕組み**: 周回内あるいは周回跨ぎで「天井」を薄く仕込み、「あと何回で格上枠が出やすくなる」などの表示で体験差を作る

## 14.4 マッチ後セッションの詳細（ミニゲームによる好感度とパラメータ開示）

### 14.4.1 セッションの流れと好感度システム

マッチ成立後の試行錯誤を、配合の成否を左右する"行動"にするため、単なるボンドゲージ上げではなく「短いミニゲームの連鎖」として実装します。現実の「会話→デート→交際」を抽象化し、「マッチングアプリやその後のデートでの会話で、プロフィールに記載されていない情報を得ていくプロセス」を再現します。

**好感度の役割**:
- 好感度が高いほど、パラメータの開示が進む（第二層→第三層→第四層）
- 好感度が高いほど、配合プランナーでの有利な条件が解放される（継承枠増加、事故率低下など）
- 好感度が高いほど、盟約条項の選択肢が増える（2〜4個）

**好感度が下がり過ぎた場合**:
- 完全ロストは避け、プレイヤーの学習の場を残す
- 契約保留（一定時間マッチ一覧から消える）: 一時的にマッチ一覧から消えるが、一定時間後に再交渉可能
- 再交渉に必要なコストが増える: 次回のミニゲームで必要な好感度の閾値が上がる

### 14.4.2 ミニゲームの種類と実装方法

マッチ後のセッションでは、以下の5種類のミニゲームから、ランダムまたは好感度に応じて選択されます。各ミニゲームは10〜30秒で終わり、2〜3回回すと何かが確定する軽さを目指します。

#### 契約交渉（会話カード）型
- **世界観**: 契約交渉の場面。相手個体との交渉を通じて、条件を詰めていく
- **UI**: 会話っぽく見せ、選択肢は「条件提示」「利益提示」「譲歩」「確認質問」のように交渉語にします
- **ゲームプレイ**: 選択肢カードを4枚提示し、プレイヤーが1枚を選択。選択したカードの種類によって、開示されるカテゴリと好感度の変化が変わる
- **開示される情報**: 第二層（準公開情報）の確定、第三層（深掘り情報）の一部

#### 共鳴調律（パズル）型
- **世界観**: 相手の"波形"にこちらを合わせる短い調整ゲーム。世界観的には「魂の周波数を合わせる」「魔力の位相を揃える」で説明できます
- **UI**: 波形を視覚的に表示し、プレイヤーがボタン操作で波形を作成・合成します
- **ゲームプレイ**: 相手の目標波形が表示され、プレイヤーは強度1～3を選択してボタンの押下間隔で波形を作成。複数の波形を合成して目標波形に近づける。成功度に応じて好感度が増え、同時に未確定パラメータの確定が進む
- **開示される情報**: 第二層（準公開情報）の確定、第三層（深掘り情報）の一部

#### 儀式手順（記憶・順序）型
- **世界観**: 相手の好む儀式の段取りがあり、それを短い順序ゲームで再現します
- **UI**: 儀式の手順を視覚的に表示し、プレイヤーが順序を記憶して再現します
- **ゲームプレイ**: 相手の好む儀式の手順が3〜5ステップで表示され、プレイヤーが同じ順序で再現。成功すると好感度と"真名の断片"が手に入る
- **開示される情報**: 第三層（深掘り情報）の一部、特に「真名の断片」などの世界観的な情報

#### 贈与/供物の調合（選択）型
- **世界観**: デートの"プレゼント"を、世界観では「供物」「触媒」「素材の精製」に置換します
- **UI**: 候補となる供物/触媒/素材を複数提示し、プレイヤーが2つを選択します
- **ゲームプレイ**: 候補から4〜6個の供物/触媒/素材を提示し、プレイヤーが2つを選択。相手の嗜好タグに合うと好感度が大きく伸び、同時に嗜好タグが確定する
- **開示される情報**: 第三層（深掘り情報）の一部、特に「嗜好タグ」「相性タグ」

#### 同行試練（短い判断）型
- **世界観**: 会話に見せずに、「この状況でどう判断するか」という二択三択を出して、相手の価値観タグを確定させる方式。世界観の説明は「契約者の資質を試す」「相棒としての判断を見る」で十分通ります
- **UI**: 状況説明と選択肢を提示し、プレイヤーが判断を選択します
- **ゲームプレイ**: 短い状況説明を提示し、2〜3択の判断を選択。相手の価値観タグに合うと好感度が伸び、価値観タグが確定する
- **開示される情報**: 第三層（深掘り情報）の一部、特に「価値観タグ」「気質」

### 14.4.3 パラメータ開示のタイミング

ミニゲームの成功度に応じて、段階的にパラメータが開示されます：
- **第二層（準公開情報）の確定**: ミニゲーム1回目で確定
- **第三層（深掘り情報）の開示**: ミニゲーム2〜3回目で段階的に開示
- **第四層（サプライズ情報）の開示**: 確率で、または好感度が一定値以上で開示

### 14.4.4 盟約（コミット）の選択

好感度が一定値以上に達した場合、またはセッション完了時に「盟約」として、トレードオフ付きの条項を2〜3枚（好感度が高い場合は4枚）提示し、プレイヤーに選ばせます。条項を選んだ瞬間に、配合プランナーの数値と条件表示が変わるようにします。

### 14.4.5 セッション完了とフィードバック

セッション完了時、以下の情報を表示：
- 最終的な好感度（ボンド値）
- 開示されたパラメータ（第二層、第三層、第四層それぞれで何が開示されたか）
- 選択した盟約条項とその効果（選択した場合）
- 配合プランナーへの反映内容（差分表示）

### 14.4.6 フィルタとの連携

「隠し過ぎるとフィルタから漏れる」問題を解決するため、フィルタには「不明を含める（要確認）」スイッチを常設します。これにより、不明な候補も候補としては表示されるが、未確定であることが明示され、スクリーニングと深掘りの導線が繋がります。

## 14.5 深層ダンジョン探索のUX設計

深層ダンジョン探索のUXは、「毎回違うのに、毎回"納得して負けられる"」を作るのが仕事です。配合とマッチングが"ランの外側（世代継承）"にあるため、探索は徹底して読みやすく、迷わせず、無駄時間を削る方向が向いています。Into the Breachが掲げた「読みやすさ・メニューの少なさ・無駄時間の最小化・短い体験・面白い選択」といった制約は、そのまま深層探索UXの設計指針にできます。

### 14.5.1 探索の基本構造：分岐ノード＋部屋単位

RPG型（非アクション）でローグをやるなら、探索の気持ちよさは「移動の操作感」ではなく「次に何を踏むかの選択」で出します。マップは自由歩行グリッドより、Slay the Spireのような"分岐ノードマップ"寄りが強いです。分岐があるだけで、同じ戦闘でも意味が変わり、ルート選択がメタ的な上達（学習）に直結します。

**ノード種別**：
- **戦闘ノード**：敵との戦闘（自動戦闘）
- **イベントノード**：選択肢があるイベント
- **休息ノード**：回復やデッキ調整に相当する整理
- **契約ノード**：ダンジョン内マッチング（偶然遭遇）
- **精錬ノード**：資源の変換や強化

そのうえで、ノードを選んで入った先は"部屋（ルーム）単位"のテンポにするのが良いです。Hadesがやっている「部屋→報酬→次の扉」という短いループは、反復を苦痛にしにくい構造です。

**UXとして**：「全体は分岐ノードで計画、局所は部屋でテンポ」の二段構えにすると、深層探索が重くならず、しかも"次の一手"が常に明確になります。

### 14.5.2 探索画面のHUD設計

深層探索が面白いローグは、だいたい"押し込むか撤退するか"を毎回迫ってきます。Darkest Dungeonが強いのは、撤退が単なる敗北ではなく「得たものは一部持ち帰れるが、目的は未達になり、後始末コストが残る」みたいな"現実的な判断"になる点です。

**探索画面の常時表示（HUD）を、次の3つに絞る**：

1. **生存資源**：HPや回復回数など、現在の生存可能性を示す情報
2. **継続リスク**：ストレス/汚染/崩壊度のような増えるほど不利なゲージ
3. **持ち帰り資産**：今回のランで"銀行に入った"分と"未精算で落とす"分

**撤退ボタン**：常に見せ、撤退時に何が持ち帰れ、何を失うかを即座に読めるようにします。これがあると、周回の緊張感を保ったまま"死んでも学べる"手触りが作れます。

ここを分けるだけで、撤退判断が"気分"ではなく"計算"になります。

### 14.5.3 ノード（部屋）の情報設計

Spelunkyの分析では、ローグのランダム性は"理不尽"ではなく、プレイヤーが個別状況の反復練習ではなく「構造やルールを学ぶ」方向に学習が移ることが重要だ、という整理がされています。

個体が一期一会である以上、探索UXは「個別ケース暗記」ではなく「判断の型を学べる」ように作るべきです。

**ノード表示の最低限**：
- **部屋種別**：戦闘/イベント/休息/契約/精錬など
- **報酬カテゴリ**：資源/情報/系譜素材/契約条項
- **危険度**：低/中/高

一方で中身を完全に開示すると作業化するので、イベントは"選択肢があること"だけ見せ、詳細は入ってから分かる程度がちょうどいい。

**重要なのは、入った後の提示が分かりやすいこと**：Into the Breachが強い"読みやすさ"の思想に寄せて、イベントの結果は「何が増え、何が減り、なぜそうなったか」を短文で返します。

### 14.5.4 マッチング要素の統合

探索中にマッチング要素を入れる場合、最大の失敗は"探索が止まる"ことです。だから置き場は2つしかありません。

#### 休息（キャンプ）ノードに寄せるやり方

休息ノードでは回復やデッキ調整に相当する整理が起きるので、短い"共鳴調律（2〜3手）"を差し込んでもテンポを壊しにくい。効果は必ず探索HUDに反映させて、次の数部屋で効いているのが分かるようにします（事故率が下がる、継承枠の条件が進む、次の遭遇が良くなる等）。

#### 契約遭遇ノード（交渉イベント）として独立させるやり方

これはダンジョン内の偶然マッチングに相当し、入る前に"何が得意になりそうか"のシルエット（タグカテゴリや契約条項の種類）だけを見せます。中では会話風UIでやってもいいですが、実体は「条件提示→譲歩/強硬/保留」のような2〜3手の交渉で十分です。

**重要なのは、成立すると"次世代資産"になる見込みがその場で読めること**：Hadesが繰り返しの中で関係や報酬を積み上げるのが上手いと言われるのは、反復が意味を持つ見せ方ができているからで、ここだけ真似すれば良いです。

### 14.5.5 深層らしさの演出

深層に行くほど、UXは複雑にしない方がいいです。むしろ操作は同じなのに、判断の意味が変わる方が"深層感"が出ます。

たとえば浅層では「危険度：高＝戦闘がつらい」ですが、深層では「危険度：高＝持ち帰り資産が多い状態だと破滅的」になり、撤退判断の重みが変わる。Darkest Dungeonの批評が指摘する"どこまで押し込むか"の緊張は、こういう設計で出ます。

UIは同じでも、プレイヤーの読みが深くなるので、学習曲線が自然にできます。

### 14.5.6 Webプロトタイプでの最小セット

UI/UXだけをWebで確認する方針に合わせると、探索フェーズはフル戦闘を作らなくても成立します。最低限、以下の要素があれば、深層探索のUXは評価できます：

1. **分岐ノードマップ**：次のノードを選択できるマップ表示
2. **ノード入室→結果（資源増減/リスク増減）→報酬選択**：部屋単位での進行
3. **撤退と精算**：撤退ボタンと、撤退時の持ち帰り資産の表示
4. **ラン終了サマリー**：なぜ失敗/成功したかの説明

さらにSlay the Spireがやっているように、選択のログを取り、どのノードが踏まれやすいか、撤退がいつ起きるか、報酬選択が偏っていないかを見て調整するのが現実的です。

## 14.6 道中ボスと要求ビルド

### 14.6.1 ボスごとの要求ビルド

戦闘が自動で敵が段階的に強くなるなら、マッチングと配合が"攻略の前提"になっている必要があります。そこで道中ボスごとに「要求されるビルド」が変わるように見せます。

ただし、条件を"硬い必須"にせず、「達成すると報酬が増える」に寄せます。例：
- 火氷耐性があると深層の報酬部屋に入れる
- 状態異常耐性があると事故を回避できる
- 特定のタグがあると封印の再起動効率が上がる

つまり"必要だから積む"ではなく"積むと得"にします。

### 14.6.2 ボスの脅威プロファイル

ボスごとに「状態異常が苛烈」「単体高火力」「範囲連打」「反射・吸収」などの脅威プロファイルを表示し、プランナーで「推奨タグ」「推奨耐性」「推奨ロール」を自然言語で提示します。

### 14.6.3 行動ループ（相談所×ダンジョン×継承）

プレイヤーは以下のループを回します：

**相談所フェーズ**:
1. 相談所の受付で「どのようなご用件でしょうか？」と質問される
2. 「候補を探す」を選択してマッチング準備（相談所の案件から"当たり素材"を確保）
3. マッチ後セッションで"狙い候補に寄せる条件"を満たす
4. 相談所に戻って「配合を計画する」を選択し、配合を実行

**探索フェーズ（ラン）**:
1. 分岐ノードマップでのルート選択
2. 部屋単位での進行（部屋→報酬→次の扉）
3. ダンジョン内マッチング（偶然遭遇：希少素材との邂逅、救助、交渉、共鳴イベント）
4. リスク管理と撤退判断
5. 帰還/崩壊（収集物・情報・契約進捗が拠点へ持ち帰られる）

**継承フェーズ**:
1. 配合でビルドを作る（系譜のコアを更新）
2. 固定化の枠を決める（知識/制度/系譜コアの選択）
3. 新世代で相談所へ戻る

勝敗が自動で決まる分、プランの正しさがそのまま結果に反映されるので、学習が早く、繰り返しが気持ちよくなります。

## 14.7 失敗の学習化

### 14.7.1 失敗周回でも価値がある設計

「魔王に届かなかった」周回でも、以下の達成を持ち帰れる：
- 「格上と成立した」
- 「欲しいタグの系譜が図鑑に刻まれた」
- 「次周回の交渉が有利になった」

これにより、ループが続きます。

### 14.7.2 学習の可視化

- **系譜図鑑**: 過去に成立したマッチの組み合わせが記録され、次周回で同系統の候補が出やすくなる

## 14.8 面白さの中心と役割分担

面白さの中心に据えるなら、露悪的な"搾取設計"に寄せなくても、変動比率の報酬と承認演出だけで十分に回ります。重要なのは、それぞれの面白さを適切に配置することです：

### 面白さの配置

- **ローグライクの面白さ**: 探索フェーズに100%置く。テンポと撤退判断と即興ビルド。
- **配合の面白さ**: 継承フェーズに置く。ランの成果を"次の世代の選択肢"に変換する儀式。
- **マッチングの面白さ**: 相談所フェーズ＋探索フェーズの一部に置く。素材獲得と条件調律を短く反復させる。
- **世界目的の面白さ**: メタ進行（制度・知識・系譜）に置く。周回するほど世界のルールが"見える/変わる"。

この配置を守ると、どれも主張しすぎず、互いを食わずに回り続けます。

### 重要な原則

- プレイヤーが「自分の判断で格上に届いた」と感じる余地を残す
- 結果の法則性を崩さない
- 転生は「戻される運命」ではなく「縁を積み上げる装置」として扱う
- 配合は"強化手段"ではなく、**ローグライク周回の生存戦略と、世代継承の経営判断**として位置づける

この四点を守ると、配合とマッチングが、魔王討伐へ向かう主エンジンになります。